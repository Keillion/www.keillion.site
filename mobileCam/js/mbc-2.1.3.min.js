/**
 * Dynamsoft JavaScript Library
 * @product Dynamsoft Mobile Browser Capture
 * @website http://www.dynamsoft.com
 * @preserve Copyright 2018, Dynamsoft Corporation
 * @author Dynamsoft
 * @version 2.1.3
 * @fileoverview Dynamsoft JavaScript Library for Basic Image Edit
 * More info on MBC: http://www.dynamsoft.com/
 */
var $jscomp={scope:{},findInternal:function(b,a,g){b instanceof String&&(b=String(b));for(var c=b.length,v=0;v<c;v++){var w=b[v];if(a.call(g,w,v,b))return{i:v,v:w}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=g.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,g,c){if(a){g=$jscomp.global;b=b.split(".");for(c=0;c<b.length-1;c++){var v=b[c];v in g||(g[v]={});g=g[v]}b=b[b.length-1];c=g[b];a=a(c);a!=c&&null!=a&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(b){return b?b:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(a,b,c){var g=this.length||0;0>b&&(b=Math.max(0,g+b));if(null==c||c>g)c=g;c=Number(c);0>c&&(c=Math.max(0,g+c));for(b=Number(b||0);b<c;b++)this[b]=a;return this}},"es6-impl","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;
$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(b){var a=0;return $jscomp.iteratorPrototype(function(){return a<b.length?{done:!1,value:b[a++]}:{done:!0}})};$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();var a=b[Symbol.iterator];return a?a.call(b):$jscomp.arrayIterator(b)};$jscomp.EXPOSE_ASYNC_EXECUTOR=!0;$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(b){function a(){this.batch_=null}if(b&&!$jscomp.FORCE_POLYFILL_PROMISE)return b;a.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};a.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var g=$jscomp.global.setTimeout;a.prototype.asyncExecuteFunction=function(a){g(a,0)};a.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=
this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var g=a[b];delete a[b];try{g()}catch(d){this.asyncThrow_(d)}}}this.batch_=null};a.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var c=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(B){b.reject(B)}};c.prototype.createResolveAndReject_=function(){function a(a){return function(d){g||(g=!0,a.call(b,d))}}var b=this,g=
!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};c.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof c)this.settleSameAsPromise_(a);else{var b;a:switch(typeof a){case "object":b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};c.prototype.resolveToNonPromiseObj_=function(a){var b=void 0;try{b=a.then}catch(B){this.reject_(B);return}"function"==
typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};c.prototype.reject_=function(a){this.settle_(2,a)};c.prototype.fulfill_=function(a){this.settle_(1,a)};c.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};c.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),
a[b]=null;this.onSettledCallbacks_=null}};var v=new a;c.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};c.prototype.settleSameAsThenable_=function(a,b){var g=this.createResolveAndReject_();try{a.call(b,g.resolve,g.reject)}catch(d){g.reject(d)}};c.prototype.then=function(a,b){function g(a,b){return"function"==typeof a?function(b){try{d(a(b))}catch(P){h(P)}}:b}var d,h,n=new c(function(a,b){d=a;h=b});this.callWhenSettled_(g(a,d),
g(b,h));return n};c.prototype["catch"]=function(a){return this.then(void 0,a)};c.prototype.callWhenSettled_=function(a,b){function g(){switch(d.state_){case 1:a(d.result_);break;case 2:b(d.result_);break;default:throw Error("Unexpected state: "+d.state_);}}var d=this;null==this.onSettledCallbacks_?v.asyncExecute(g):this.onSettledCallbacks_.push(function(){v.asyncExecute(g)})};c.resolve=function(a){return a instanceof c?a:new c(function(b,g){b(a)})};c.reject=function(a){return new c(function(b,g){g(a)})};
c.race=function(a){return new c(function(b,g){for(var d=$jscomp.makeIterator(a),h=d.next();!h.done;h=d.next())c.resolve(h.value).callWhenSettled_(b,g)})};c.all=function(a){var b=$jscomp.makeIterator(a),g=b.next();return g.done?c.resolve([]):new c(function(a,h){function d(b){return function(g){w[b]=g;A--;0==A&&a(w)}}var w=[],A=0;do w.push(void 0),A++,c.resolve(g.value).callWhenSettled_(d(w.length-1),h),g=b.next();while(!g.done)})};$jscomp.EXPOSE_ASYNC_EXECUTOR&&(c.$jscomp$new$AsyncExecutor=function(){return new a});
return c},"es6-impl","es3");var kUtil=kUtil||{};Math.sign||(Math.sign=function(b){return 0<b?1:0==b?0>1/b?-0:0:0>b?-1:NaN});kUtil.Matrix=function(b,a,g,c,v,w){this.a=b;this.b=a;this.c=g;this.d=c;this.e=v;this.f=w};kUtil.Matrix.dot=function(b,a){return new kUtil.Matrix(b.a*a.a+b.c*a.b,b.b*a.a+b.d*a.b,b.a*a.c+b.c*a.d,b.b*a.c+b.d*a.d,b.a*a.e+b.c*a.f+b.e,b.b*a.e+b.d*a.f+b.f)};kUtil.Matrix.prototype.dot=function(b){return kUtil.Matrix.dot(this,b)};
kUtil.Matrix.equals=function(b,a){return b.a==a.a&&b.b==a.b&&b.c==a.c&&b.d==a.d&&b.e==a.e&&b.f==a.f};kUtil.Matrix.prototype.equals=function(b){return kUtil.Matrix.equals(this,b)};kUtil.Matrix.prototype.inversion=function(){var b=this.a,a=this.b,g=this.c,c=this.d,v=this.e,w=this.f,S=b*c-a*g;return new kUtil.Matrix(c/S,-a/S,-g/S,b/S,(g*w-c*v)/S,(a*v-b*w)/S)};
kUtil.convertURLToBlob=function(b,a){var g=new XMLHttpRequest;g.open("GET",b,!0);g.responseType="blob";g.onloadend=function(){a(this.response)};g.send()};kUtil.convertBase64ToBlob=function(b,a){for(var g=atob(b),c=Array(g.length),v=0;v<g.length;++v)c[v]=g.charCodeAt(v);g=new Uint8Array(c);return new Blob([g],{type:a})};
Date.prototype.kUtilFormat=function(b){var a={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var g in a)(new RegExp("("+g+")")).test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[g]:("00"+a[g]).substr((""+a[g]).length)));return b};
kUtil.copyToClipBoard=function(b){if(navigator.clipboard)navigator.clipboard.writeText(b)["catch"](function(a){alert("copy failed, info: "+(a.message||a))});else{var a=document.createElement("textarea");a.style.width="4px";a.style.height="4px";a.style.position="fixed";a.style.left="0";a.style.top="0";$(document.body).append(a);a.value=b;if(b=navigator.userAgent.match(/ipad|iphone/i)){var g=document.createRange();g.selectNodeContents(a);var c=window.getSelection();c.removeAllRanges();c.addRange(g);
a.setSelectionRange(0,999999)}else a.focus(),a.select();try{document.execCommand("copy")||b||alert("copy failed")}catch(v){alert("copy failed, info: "+(v.message||v))}$(a).remove()}};
(function(b){b.fn.borderWidth=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("border-left-width"):a.getAttribute("border-left-width"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("border-top-width"):a.getAttribute("border-top-width"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("border-right-width"):a.getAttribute("border-right-width"))||0;b.bottom=parseFloat(a.getPropertyValue?
a.getPropertyValue("border-bottom-width"):a.getAttribute("border-bottom-width"))||0;return b};b.fn.padding=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-left"):a.getAttribute("padding-left"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-top"):a.getAttribute("padding-top"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-right"):a.getAttribute("padding-right"))||
0;b.bottom=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-bottom"):a.getAttribute("padding-bottom"))||0;return b};b.fn.borderBoxRect=function(){var a=null;window.getComputedStyle&&(a=getComputedStyle(this[0]));var b=this.offset(),c={};c.pageX0=b.left;c.pageY0=b.top;c.width=a?parseFloat(a.width):this.outerWidth();c.height=a?parseFloat(a.height):this.outerHeight();c.pageX1=c.pageX0+c.width;c.pageY1=c.pageY0+c.height;return c};b.fn.paddingBoxRect=function(){var a=this.borderBoxRect(),b=this.borderWidth(),
c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.innerWidth();c.height=window.getComputedStyle?a.height-(b.top+b.bottom):this.innerHeight();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};b.fn.contentBoxRect=function(){var a=this.paddingBoxRect(),b=this.padding(),c={};c.pageX0=a.pageX0+b.left;c.pageY0=a.pageY0+b.top;c.width=window.getComputedStyle?a.width-(b.left+b.right):this.width();c.height=window.getComputedStyle?
a.height-(b.top+b.bottom):this.height();c.pageX1=a.pageX1-b.right;c.pageY1=a.pageY1-b.bottom;return c};b.fn.getTransform=function(){var a=this.css("transform");if("none"==a||""==a)a=this[0].style.transform;var b="matrix(",c=a.indexOf(b);if(-1!=c){c+=b.length;a=a.substring(c,a.indexOf(")",c)).split(",");for(b=0;b<a.length;++b)a[b]=parseFloat(a[b]);return new kUtil.Matrix(a[0],a[1],a[2],a[3],a[4],a[5])}b="scale(";c=a.indexOf(b);return-1!=c?(c+=b.length,a=parseFloat(a.substring(c)),new kUtil.Matrix(a,
0,0,a,0,0)):new kUtil.Matrix(1,0,0,1,0,0)};b.fn.setTransform=function(a){a="matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join()+")";this.css("transform",a)}})(jQuery);var TaskQueue=function(){this._queue=[];this.isWorking=!1;this.timeout=100};TaskQueue.prototype.push=function(b,a,g){this._queue.push({task:b,context:a,args:g});this.isWorking||this.next()};TaskQueue.prototype.unshift=function(b,a,g){this._queue.unshift({task:b,context:a,args:g});this.isWorking||this.next()};
TaskQueue.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var b=this._queue.shift(),a=b.task,g=b.context?b.context:self,c=b.args?b.args:[];setTimeout(function(){a.apply(g,c)},this.timeout)}};
(function(){function b(a,b){b||a.match(/^data\:([^\;]+)\;base64,/mi);a=a.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var m=atob(a),d=m.length,c=new ArrayBuffer(d),g=new Uint8Array(c),r=0;r<d;r++)g[r]=m.charCodeAt(r);return c}function a(a,b){var m=new XMLHttpRequest;m.open("GET",a,!0);m.responseType="blob";m.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};m.send()}function g(m,d){function g(a){var b=c(a),g;a:if(g=new DataView(a),255!=g.getUint8(0)||216!=g.getUint8(1))g=!1;
else{for(var u=2,r=a.byteLength;u<r;){var y=g,h=u;if(56===y.getUint8(h)&&66===y.getUint8(h+1)&&73===y.getUint8(h+2)&&77===y.getUint8(h+3)&&4===y.getUint8(h+4)&&4===y.getUint8(h+5)){y=g.getUint8(u+7);0!==y%2&&(y+=1);0===y&&(y=4);var r=u+8+y,u=g.getUint16(u+6+y),n,R;g=r;r=new DataView(a);y={};for(h=g;h<g+u;)28===r.getUint8(h)&&2===r.getUint8(h+1)&&(n=r.getUint8(h+2),n in W&&(R=r.getInt16(h+3),n=W[n],R=S(r,h+5,R),y.hasOwnProperty(n)?y[n]instanceof Array?y[n].push(R):y[n]=[y[n],R]:y[n]=R)),h++;g=y;break a}u++}g=
void 0}var w;a:if("DOMParser"in self)if(u=new DataView(a),255!=u.getUint8(0)||216!=u.getUint8(1))w=!1;else{r=2;y=a.byteLength;for(a=new DOMParser;r<y-4;)if("http"==S(u,r,4)){y=r-1;r=u.getUint16(r-2)-1;u=S(u,y,r);r=u.indexOf("xmpmeta>")+8;u=u.substring(u.indexOf("<x:xmpmeta"),r);r=u.indexOf("x:xmpmeta")+10;u=u.slice(0,r)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
u.slice(r);b:{a=a.parseFromString(u,"text/xml");try{u={};if(0<a.children.length)for(r=0;r<a.children.length;r++){var Z=a.children.item(r),X=Z.attributes,A;for(A in X){var U=X[A],x=U.nodeName,k=U.nodeValue;void 0!==x&&(u[x]=k)}var t=Z.nodeName;if("undefined"==typeof u[t])u[t]=xml2json(Z);else{if("undefined"==typeof u[t].push){var e=u[t];u[t]=[];u[t].push(e)}u[t].push(xml2json(Z))}}else u=a.textContent;w=u;break b}catch(f){console.log(f.message)}w=void 0}break a}else r++;w=void 0}else w=void 0;m.exifdata=
b||{};m.iptcdata=g||{};m.xmpdata=w||{};d&&d.call(m)}if(m.src)if(/^data\:/i.test(m.src)){var y=b(m.src);g(y)}else if(/^blob\:/i.test(m.src)){var h=new FileReader;h.onload=function(a){g(a.target.result)};a(m.src,function(a){h.readAsArrayBuffer(a)})}else{var n=new XMLHttpRequest;n.onload=function(){if(200==this.status||0===this.status)g(n.response);else throw"Could not load image";n=null};n.open("GET",m.src,!0);n.responseType="arraybuffer";n.send(null)}else self.FileReader&&(m instanceof self.Blob||
m instanceof self.File)&&(h=new FileReader,h.onload=function(a){g(a.target.result)},h.readAsArrayBuffer(m))}function c(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var m=2;a=a.byteLength;for(var d;m<a;){if(255!=b.getUint8(m))return!1;d=b.getUint8(m+1);if(225==d)return B(b,m+4,b.getUint16(m+2)-2);m+=2+b.getUint16(m+2)}}function v(a,b,d,g,c){var m=a.getUint16(d,!c),r={},D,y,u;for(u=0;u<m;u++)D=d+12*u+2,y=g[a.getUint16(D,!c)],r[y]=w(a,D,b,d,c);return r}function w(a,b,d,
g,c){var m=a.getUint16(b+2,!c);g=a.getUint32(b+4,!c);d=a.getUint32(b+8,!c)+d;var r,D;switch(m){case 1:case 7:if(1==g)return a.getUint8(b+8,!c);d=4<g?d:b+8;b=[];for(m=0;m<g;m++)b[m]=a.getUint8(d+m);return b;case 2:return S(a,4<g?d:b+8,g-1);case 3:if(1==g)return a.getUint16(b+8,!c);d=2<g?d:b+8;b=[];for(m=0;m<g;m++)b[m]=a.getUint16(d+2*m,!c);return b;case 4:if(1==g)return a.getUint32(b+8,!c);b=[];for(m=0;m<g;m++)b[m]=a.getUint32(d+4*m,!c);return b;case 5:if(1==g)return r=a.getUint32(d,!c),D=a.getUint32(d+
4,!c),a=new Number(r/D),a.numerator=r,a.denominator=D,a;b=[];for(m=0;m<g;m++)r=a.getUint32(d+8*m,!c),D=a.getUint32(d+4+8*m,!c),b[m]=new Number(r/D),b[m].numerator=r,b[m].denominator=D;return b;case 9:if(1==g)return a.getInt32(b+8,!c);b=[];for(m=0;m<g;m++)b[m]=a.getInt32(d+4*m,!c);return b;case 10:if(1==g)return a.getInt32(d,!c)/a.getInt32(d+4,!c);b=[];for(m=0;m<g;m++)b[m]=a.getInt32(d+8*m,!c)/a.getInt32(d+4+8*m,!c);return b}}function S(a,b,d){for(var g="",m=b;m<b+d;m++)g+=String.fromCharCode(a.getUint8(m));
return g}function B(a,b){if("Exif"!=S(a,b,4))return!1;var d,g,c,m,r=b+6;if(18761==a.getUint16(r))d=!1;else if(19789==a.getUint16(r))d=!0;else return!1;if(42!=a.getUint16(r+2,!d))return!1;var D=a.getUint32(r+4,!d);if(8>D)return!1;g=v(a,r,r+D,F,d);if(g.ExifIFDPointer)for(c in m=v(a,r,r+g.ExifIFDPointer,n,d),m){switch(c){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":m[c]=
P[c][m[c]];break;case "ExifVersion":case "FlashpixVersion":m[c]=String.fromCharCode(m[c][0],m[c][1],m[c][2],m[c][3]);break;case "ComponentsConfiguration":m[c]=P.Components[m[c][0]]+P.Components[m[c][1]]+P.Components[m[c][2]]+P.Components[m[c][3]]}g[c]=m[c]}if(g.GPSInfoIFDPointer)for(c in m=v(a,r,r+g.GPSInfoIFDPointer,A,d),m){switch(c){case "GPSVersionID":m[c]=m[c][0]+"."+m[c][1]+"."+m[c][2]+"."+m[c][3]}g[c]=m[c]}D=r+D;c=a.getUint16(D,!d);if(D=a.getUint32(D+2+12*c,!d))if(D>a.byteLength)r={};else{D=
v(a,r,r+D,C,d);if(D.Compression)switch(D.Compression){case 6:D.JpegIFOffset&&D.JpegIFByteCount&&(D.blob=new Blob([new Uint8Array(a.buffer,r+D.JpegIFOffset,D.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",D.Compression)}else 2==D.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");r=D}else r={};g.thumbnail=r;return g}
var d=self,h=function(a){if(a instanceof h)return a;if(!(this instanceof h))return new h(a);this.EXIFwrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=h),exports.EXIF=h):d.EXIF=h;var n=h.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",
36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",
41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",
42016:"ImageUniqueID"},F=h.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",
301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},A=h.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",
16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},C=h.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",
278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},P=h.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",
24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},W={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",
105:"headline",116:"copyright",15:"category"};h.getData=function(a,b){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?b&&b.call(a):g(a,b);return!0};h.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};h.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};h.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};h.getAllIptcTags=
function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};h.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};h.readFromBinaryFile=function(a){return c(a)};"function"===typeof define&&define.amd&&define("exif-js",
[],function(){return h})}).call(this);
var KPainter=function(b){var a=this;b=b||{};KPainter.xxx="mouse"==b.gesturer?!1:"touch"==b.gesturer?!0:"ontouchend"in document?!0:!1;var g=function(a,b,c,d){a.toBlob?a.toBlob(b,c,d):(a=a.toDataURL(c,d),c=kUtil.convertBase64ToBlob(a.substring(a.indexOf(",")+1),c),b(c))},c=function(a,b,c){b=b||new kUtil.Matrix(1,0,0,1,0,0);var d=document.createElement("canvas"),g=!1;0!=b.a*b.d&&0==b.b*b.c?(d.width=a.naturalWidth||a.width,d.height=a.naturalHeight||a.height):(g=!0,d.width=a.naturalHeight||a.height,d.height=
a.naturalWidth||a.width);if(d.width>c||d.height>c)c/=Math.max(d.width,d.height),d.width=Math.min(d.width*c),d.height=Math.min(d.height*c);c=d.getContext("2d");c.setTransform(b.a,b.b,b.c,b.d,b.e*d.width,b.f*d.height);g?c.drawImage(a,0,0,d.height,d.width):c.drawImage(a,0,0,d.width,d.height);return d},v=function(a,b,d,g){var D=function(){var D=URL.createObjectURL(a),m=new Image;m.onload=m.onerror=function(){m.onload=m.onerror=null;var a=c(m,b,g);URL.revokeObjectURL(D);d(a)};m.src=D};window.createImageBitmap?
createImageBitmap(a).then(function(a){d(c(a,b,g))})["catch"](function(){D()}):D()},w=KPainter._doCallbackNoBreak,S=$('<div style="width:800px;height:600px;border:1px solid #ccc;"><div class="kPainterBox"><div class="kPainterImgsDiv"><canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas></div><div class="kPainterCroper" style="width:50px;height:50px;display:none;"><div class="kPainterCells"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div><div class="kPainterEdges"><div data-orient="-1,0"></div><div data-orient="0,-1"></div><div data-orient="1,0"></div><div data-orient="0,1"></div></div><div class="kPainterCorners"><div data-orient="-1,-1"><i></i></div><div data-orient="1,-1"><i></i></div><div data-orient="1,1"><i></i></div><div data-orient="-1,1"><i></i></div></div><div class="kPainterMover" data-orient="0,0"><div></div><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg></div></div><div class="kPainterPerspect" style="display:none;"><canvas class="kPainterPerspectCvs"></canvas><div class="kPainterPerspectCorner" data-index="0">lt</div><div class="kPainterPerspectCorner" data-index="1">rt</div><div class="kPainterPerspectCorner" data-index="2">rb</div><div class="kPainterPerspectCorner" data-index="3">lb</div></div><div class="kPainterGesturePanel"></div></div></div>')[0],
B=$(S).children(),d=B.find("> .kPainterImgsDiv > .kPainterCanvas")[0];a.getHtmlElement=function(){return S};var h=-1,n=[],F=null,A=null,C=!1,P="view";a.getCurIndex=function(){return h};a.getCount=function(){return n.length};a.isEditing=function(){return C};a.getMode=function(){return P};a.getImage=function(a,b){void 0==b&&(b=h);if(!(isNaN(b)||(b=Math.round(b),0>b||b>=n.length))){var c;a?c=n[b]:(c=$(n[b]).clone()[0],c.setAttribute("style",""));return c}};a.onStartLoading=null;a.onFinishLoading=null;
var W=function(){w(a.onStartLoading)},m=function(){w(a.onFinishLoading)},y=new function(){a.defaultFileInput=$('<input type="file" accept="image/bmp,image/gif,image/jpeg,image/png,image/webp" multiple style="display:none">')[0];a.beforeAddImgFromFileChooseWindow=null;a.afterAddImgFromFileChooseWindow=null;$(a.defaultFileInput).change(function(b){var k=this;b=b.originalEvent;a.beforeAddImgFromFileChooseWindow?w(a.beforeAddImgFromFileChooseWindow,[b,function(b){d(b,function(b){w(a.afterAddImgFromFileChooseWindow,
[b]);k.value=""})}]):d(k.files,function(b){w(a.afterAddImgFromFileChooseWindow,[b]);k.value=""})});a.showFileChooseWindow=function(){if(C)return!1;a.defaultFileInput.click();return!0};a.beforeAddImgFromDropFile=null;a.afterAddImgFromDropFile=null;B.on("dragover",function(a){a=a.originalEvent;a.stopPropagation();a.preventDefault()});B.on("drop",function(b){b=b.originalEvent;b.stopPropagation();b.preventDefault();a.beforeAddImgFromDropFile?w(a.beforeAddImgFromDropFile,[b,function(b){d(b,a.afterAddImgFromDropFile)}]):
d(b.dataTransfer.files,a.afterAddImgFromDropFile)});var b=new TaskQueue,d=a.addImageAsync=function(a,c){if(C)w(c,[!1]);else if(a)if(a instanceof Blob||a instanceof HTMLCanvasElement||"string"==typeof a||a instanceof String||a instanceof HTMLImageElement)W(),b.push(y,null,[a,function(a){w(c,[a]);b.next();b.isWorking||m()}]);else if(a instanceof Array||a instanceof FileList)for(var e=[],f=!1,k=0;k<a.length;++k)d(a[k],function(b){e.push(b);f=f||b;e.length==a.length&&w(c,[f,e])});else w(c,[!1]);else w(c,
[!1])},z=function(a,b){"image/jpeg"!=a.type?b(null):EXIF.getData(a,function(){var a=null;switch(EXIF.getTag(this,"Orientation")){case 6:a=new kUtil.Matrix(0,1,-1,0,1,0);break;case 3:a=new kUtil.Matrix(-1,0,0,-1,1,1);break;case 8:a=new kUtil.Matrix(0,-1,1,0,0,1)}b(a)})},u=function(a,b){var e=a.slice(25,26),f=new FileReader;f.onload=function(){var a=(new Int8Array(f.result))[0];b(4==(a&4))};f.readAsArrayBuffer(e)},A=function(a,b){var e=a.type;-1!=e.indexOf("webp")?b&&b("image/webp"):-1!=e.indexOf("gif")||
-1!=e.indexOf("svg")?b&&b("image/png"):-1!=e.indexOf("png")?u(a,function(a){b&&b(a?"image/png":"image/jpeg")}):b&&b("image/jpeg")},y=function(a,b){I(a,function(a,f){a?w(function(){F(a,f,b)}):b(!1)})},I=this.getBlobAndFormatFromAnyImgData=function(a,b){var e=function(a){A(a,function(e){z(a,function(f){H(a,f,e,function(a){b(a,e)})})})};if(a instanceof Blob)e(a);else if(a instanceof HTMLCanvasElement)g(a,function(a){e(a)});else if("string"==typeof a||a instanceof String)if("data:"==a.substring(0,5)){var f=
"";"image/"==a.substring(5,11)&&(f=a.substring(5,a.indexOf(";",11)));f=kUtil.convertBase64ToBlob(a.substring(a.indexOf("base64,")+7),f);e(f)}else kUtil.convertURLToBlob(a,function(a){a?e(a):b(null,"")});else if(a instanceof HTMLImageElement){var k;try{k=a.src}catch(l){setTimeout(function(){throw l;},0);b(null,"");return}I(k,function(f,c){if(f)b(f,c);else{var q=document.createElement("canvas");q.width=a.naturalWidth;q.height=a.naturalHeight;q.getContext("2d").drawImage(a,0,0);var l="",d=k.lastIndexOf("?"),
p=-1;-1!=d?(p=k.lastIndexOf(".",d),-1!=p&&5>=d-p&&(l=k.substring(p+1,d))):(p=k.lastIndexOf("."),-1!=p&&(l=5>=k.length-p?k.substring(p+1):k.substring(p+1,p+5)));l=-1!=l.indexOf("webp")?"image/webp":-1!=l.indexOf("png")||-1!=l.indexOf("gif")||-1!=l.indexOf("svg")?"image/png":"image/jpeg";g(q,function(a){e(a)},l)}})}else b(null,"")};a.addedImageMaxWH=4096;var H=function(a,b,e,f){b?v(a,b,function(a){g(a,function(a){f&&f(a)},e)}):f&&f(a)};a.isShowNewImgWhenAdd=!0;var F=function(b,d,e){var f=new Image;
f.kPainterOriBlob=f.kPainterBlob=b;f.kPainterSaveFormat=d;var k=URL.createObjectURL(f.kPainterBlob);f.onload=f.onerror=function(){a._noAnyUseButForIosSafariBug0=f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;f.kPainterWidth=f.naturalWidth;f.kPainterHeight=f.naturalHeight;f.kPainterOriWidth=f.kPainterWidth;f.kPainterOriHeight=f.kPainterHeight;if(f.kPainterWidth>a.addedImageMaxWH||f.kPainterHeight>a.addedImageMaxWH)g(c(f,null,a.addedImageMaxWH),function(a){URL.revokeObjectURL(k);f.kPainterOriBlob=
f.kPainterBlob=a;k=URL.createObjectURL(f.kPainterBlob);f.src=k},d);else{f.onload=f.onerror=null;(a.isShowNewImgWhenAdd||-1==h)&&G(n.length-1);try{(function(){for(var a=0;a<l.length;++a){var b=l[a].cvs,e=l[a].mwh,e=Math.min(e/f.naturalWidth,e/f.naturalHeight,1);b.width=Math.round(f.naturalWidth*e);b.height=Math.round(f.naturalHeight*e);b.getContext("2d").drawImage(f,0,0,b.width,b.height)}})()}catch(q){setTimeout(function(){throw q;},0)}e&&e(!0)}};f.src=k;$(f).hide();B.children(".kPainterImgsDiv").append(f);
n.push(f);var l=[];try{(function(){for(var a=0;a<x.length;++a){var b=x[a],e=b.kPainterFunWrap,f=document.createElement("canvas");f.className="kPainterThumbnailCanvas";l.push({cvs:f,mwh:b.kPainterMaxWH});var k=null;try{k=e?e(f):f}catch(Y){setTimeout(function(){throw Y;},0);break}k&&(k.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(k),b.appendChild(k))}})()}catch(q){setTimeout(function(){throw q;},0)}},M=function(){var b=n[h],c=B;c.paddingBoxRect();
var c=c.contentBoxRect(),e=b.kPainterZoom=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight);b.style.width=(Math.round(b.kPainterWidth*e)||1)+"px";b.style.height=(Math.round(b.kPainterHeight*e)||1)+"px";b.style.left=b.style.right=b.style.top=b.style.bottom="-100000px";if(2<=n.length){var f=n[(n.length+h-1)%n.length],e=Math.min(c.width/f.kPainterWidth,c.height/f.kPainterHeight);f.style.width=(Math.round(f.kPainterWidth*e)||1)+"px";f.style.height=(Math.round(f.kPainterHeight*e)||1)+"px";f.style.right=
"100000px";f.style.left=f.style.top=f.style.bottom="-100000px"}3<=n.length&&(b=n[(n.length+h+1)%n.length],e=Math.min(c.width/b.kPainterWidth,c.height/b.kPainterHeight),b.style.width=(Math.round(b.kPainterWidth*e)||1)+"px",b.style.height=(Math.round(b.kPainterHeight*e)||1)+"px",b.style.left="100000px",b.style.right=b.style.top=f.style.bottom="-100000px");w(a.onUpdateImgPosZoom)},O=null,Q;a.updateUIOnResize=function(b,c){null!=O&&(clearTimeout(O),O=null);if(b)Q=C,O=setTimeout(function(){if(-1!=h&&Q==
C){if(C){var b=a.getFreeTransformCornerPos();R.setImgStyleFit();a.setFreeTransformCornerPos(b)}else M();w(c)}O=null},500);else if(-1!=h){if(C){var e=a.getFreeTransformCornerPos();R.setImgStyleFit();a.setFreeTransformCornerPos(e)}else M();w(c)}};var G=this.showImg=function(b){var k=n[b];$(k).siblings().hide();h=b;$(k).show();2<=n.length&&(0<b||a.allowedTouchMoveSwitchImgOverBoundary)&&$(n[(n.length+b-1)%n.length]).show();3<=n.length&&(b<n.length-1||a.allowedTouchMoveSwitchImgOverBoundary)&&$(n[(n.length+
b+1)%n.length]).show();M();E()};a.onNumChange=null;var E=function(){var b=void 0,c=void 0;return function(){if(b!=h||c!=n.length)b=h,c=n.length,w(a.onNumChange,[h,n.length])}}();a.changePage=function(a){if(C)return!1;var b;switch(a){case "f":b=0;break;case "p":b=h-1;break;case "n":b=h+1;break;case "l":b=n.length-1;break;default:if(1>arguments.length||isNaN(a))return!1;b=Math.round(a)}if(0>b||b>=n.length||b==h)return!1;G(b);return!0};a.del=function(a){if(C)return!1;1>arguments.length&&(a=h);if(isNaN(a))return!1;
a=Math.round(a);if(0>a||a>=n.length)return!1;URL.revokeObjectURL(n[a].src);$(n[a]).remove();n.splice(a,1);try{for(var b=0;b<x.length;++b){var e=x[b];$(e.kPainterThumbBoxArr[a]).remove();e.kPainterThumbBoxArr.splice(a,1)}}catch(f){setTimeout(function(){throw f;},0)}a<h?(--h,E()):a==h?(h==n.length&&--h,0<=h?G(h):E()):E();return!0};a.getWidth=function(a){1>arguments.length&&(a=h);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=n.length?NaN:n[a].kPainterWidth};a.getHeight=function(a){1>arguments.length&&
(a=h);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=n.length?NaN:n[a].kPainterHeight};a.getBlob=function(a){1>arguments.length&&(a=h);if(isNaN(a))return null;a=Math.round(a);return 0>a||a>=n.length?null:n[a].kPainterBlob};a.download=function(a,b){2>arguments.length&&(b=h);if(isNaN(b))return null;b=Math.round(b);if(0>b||b>=n.length)return null;var e=document.createElement("a");e.target="_blank";var f=n[b].kPainterBlob;if(!a){var c="";f.type&&(c=f.type.substring(f.type.indexOf("/")+1));c="jpeg"==
c?".jpg":"."+c;a=(new Date).getTime()+c}e.download=a;var l=URL.createObjectURL(f);e.href=l;f=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});e.dispatchEvent(f);setTimeout(function(){URL.revokeObjectURL(l)},1E4);return a};var x=this.thumbnailBoxArr=[];a.bindThumbnailBox=function(b,c,e){if(C||!(b instanceof HTMLElement))return!1;a.unbindThumbnailBox(b);b.innerHTML="";b.kPainterFunWrap=c;b.kPainterMaxWH=e||256;b.kPainterThumbBoxArr=[];for(e=0;e<n.length;++e){var f=n[e];a._noAnyUseButForIosSafariBug0=
f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;var d=Math.min(b.kPainterMaxWH/f.naturalWidth,b.kPainterMaxWH/f.naturalHeight,1),l=document.createElement("canvas");l.width=Math.round(f.naturalWidth*d);l.height=Math.round(f.naturalHeight*d);l.getContext("2d").drawImage(f,0,0,l.width,l.height);l.className="kPainterThumbnailCanvas";f=null;try{f=c?c(l):l}catch(q){return setTimeout(function(){throw q;},0),!1}f&&(f.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(f),
b.appendChild(f))}x.push(b);return!0};a.unbindThumbnailBox=function(a){if(C)return!1;if(a){for(var b=0;b<x.length;++b)if(x[b]==a)return a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0,x.splice(b,1),!0;return!1}for(b=0;b<x.length;++b)a=x[b],a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0;x.length=0;return!0}};(function(a){a=a.length?a[0]:function(a){var b=a.indexOf(".");return[a.substring(b,b+32),a.substring(0,8)]}(location.host);for(var b=null,c=0;c<a.length;++c){for(var d=
1,g=a[c],m=0;m<g.length;++m)d*=g.charCodeAt(m),d+=g.charCodeAt((m+1)%g.length),d%=11003;if(1!=d&&7480!=d&&5095!=d&&3124!=d&&8633!=d&&3122!=d)b=setTimeout(function(){w=function(){}},1E5*(1+2*Math.random()));else{null!==b&&clearTimeout(b);break}}})(arguments);var R=new function(){var b=Number.NEGATIVE_INFINITY,c;a.leftDoubleClickZoomRate=2;a.rightDoubleClickZoomRate=.5;var g,m,v,T,I,H,K,M,O,Q,G,E,x,k,t,e,f,p,l,q,L,J;a.allowedTouchMoveSwitchImgOverBoundary=!0;var aa=function(){if(-1!=h&&"posZoom"==F){F=
A=null;B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index",1);B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",1);B.find("> .kPainterCroper > .kPainterMover").css("z-index",1);B.find("> .kPainterCroper > .kPainterBigMover").css("z-index",1);if(!C&&1!=n.length){var f=!1,c,d;1.2>q/L&&(f=!0,c=Math.sqrt(Math.pow(I-g,2)+Math.pow(H-m,2)),d=c/(((new Date).getTime()-b)/1E3));if(p<-(Math.round(e*q)||1)/2||f&&-50>c&&-200>d){if(h+1<n.length||a.allowedTouchMoveSwitchImgOverBoundary){y.showImg((n.length+
h+1)%n.length);return}}else if(p>(Math.round(e*q)||1)/2||f&&50<c&&200<d)if(0<=h-1||a.allowedTouchMoveSwitchImgOverBoundary){y.showImg((n.length+h-1)%n.length);return}}V();Y()}},N=function(a){var b=B;C?(k=d,e=k.width,f=k.height):(k=n[h],e=k.kPainterWidth,f=k.kPainterHeight);p=parseFloat(k.style.left)+1E5;l=parseFloat(k.style.top)+1E5;t=$(k).getTransform();if(0==t.a*t.d||0!=t.b*t.c){var c=e;e=f;f=c}q=k.kPainterZoom||1;E=b.paddingBoxRect();x=b.contentBoxRect();L=Math.min(x.width/e,x.height/f);C&&X.isCropRectShowing&&
!a&&(a=X.getNeededRect(),L=Math.max(Math.max(a.width,e*L)/e,Math.max(a.height,f*L)/f))};a.onUpdateImgPosZoom=null;var Y=function(){k.style.left=p-1E5+"px";k.style.right=-p-1E5+"px";k.style.top=l-1E5+"px";k.style.bottom=-l-1E5+"px";k.kPainterZoom=q;0!=t.a*t.d&&0==t.b*t.c?(k.style.width=(Math.round(e*q)||1)+"px",k.style.height=(Math.round(f*q)||1)+"px"):(k.style.height=(Math.round(e*q)||1)+"px",k.style.width=(Math.round(f*q)||1)+"px");if(!C&&1!=n.length){var b=Math.max(0,((Math.round(e*q)||1)-E.width)/
2);if(2<n.length||p>b){var c=n[(n.length+h-1)%n.length];c.style.left=p-b-E.width+"px";c.style.right=-p+b+E.width+"px"}if(2<n.length||p<=-b)c=n[(n.length+h+1)%n.length],c.style.left=p+b+E.width+"px",c.style.right=-p-b-E.width+"px"}w(a.onUpdateImgPosZoom)},V=function(a,b){4<q&&(q=4);q<L&&(q=L);if(!a){var c=Math.round(e*q)||1;x.width>c?p=0:(c=(c-x.width)/2,p<-c?p=-c:p>c&&(p=c))}b||(c=Math.round(f*q)||1,x.height>c?l=0:(c=(c-x.height)/2,l<-c?l=-c:l>c&&(l=c)))};a.getZoom=function(){if(0!=n.length)return N(),
q};a.setZoom=function(a,b){if(0==n.length)return null;a=parseFloat(a);if(a!==a)return null;N();q=b?q*a:a;V();Y();return q};this.setImgStyleFit=function(){N(!0);q=L;V();Y();a.setCropRectArea()};B.on("touchstart touchcancel touchend mousedown",function(e){e.preventDefault();if(-1!=h){var f=e.originalEvent;e=f.targetTouches;var d;if(!e){if(!A)A="mouse";else if("mouse"!=A)return;e=[{pageX:f.clientX,pageY:f.clientY}];d=f.buttons}else if(e.length)if(!A)A="touch";else if("touch"!=A)return;if(1==e.length){I=
g=e[0].pageX;H=m=e[0].pageY;N();f=b;b=(new Date).getTime();var k=c;c=d||(.01>Math.abs(q-L)/L?1:2);if(1E3>b-f&&c==k&&(1==c||2==c)&&8>Math.abs(e[0].pageX-v)&&8>Math.abs(e[0].pageY-T)){b=Number.NEGATIVE_INFINITY;d=I;var f=H,x=q,k=1==c?a.leftDoubleClickZoomRate:a.rightDoubleClickZoomRate;q*=k;4<q&&(q=4,k=4/x);q<L&&(q=L,k=L/x);x=l+E.pageY0+E.height/2;p-=(k-1)*(d-(p+E.pageX0+E.width/2));l-=(k-1)*(f-x);V()}null==F&&(F="posZoom",B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),
B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),B.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),J=e[0].identifier)}else 2==e.length?(I=g=e[0].pageX,H=m=e[0].pageY,null==F&&(F="posZoom"),"posZoom"==F&&(N(),B.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),B.find("> .kPainterCroper > .kPainterMover").css("z-index",
"unset"),B.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),O=e[1].pageX,Q=e[1].pageY,K=(I+O)/2,M=(H+Q)/2,G=Math.sqrt(Math.pow(I-O,2)+Math.pow(H-Q,2)))):0==e.length&&(v=I,T=H,aa())}});B.on("mouseup",function(a){"mouse"==A&&(a=a.originalEvent,v=a.clientX,T=a.clientY,aa())});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&(v=I,T=H,aa())});B.on("contextmenu",function(a){a.preventDefault()});B.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;
if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length){if("posZoom"==F&&J==b[0].identifier){a=I;var e=H;I=b[0].pageX;H=b[0].pageY;p+=I-a;l+=H-e;V(!C);Y()}}else if(2==b.length&&"posZoom"==F){a=K;var e=M,f=G,c=q;I=b[0].pageX;H=b[0].pageY;O=b[1].pageX;Q=b[1].pageY;K=(I+O)/2;M=(H+Q)/2;G=Math.sqrt(Math.pow(I-O,2)+Math.pow(H-Q,2));b=G/f;q*=b;4<q&&(q=4,b=4/c);q<L&&(q=L,b=L/c);c=l+E.pageY0+E.height/2;p-=(b-1)*(a-(p+E.pageX0+
E.width/2));l-=(b-1)*(e-c);V();Y()}})},U=new function(){var b=this,c,z=[];a.stepImgsGCThreshold=10;var u=[],v=[];a.addProtectedStep=function(a){if(!C)return!1;a=parseInt(a);if(a!==a)return!1;if(-1!=v.indexOf(a))return!0;v.push(a);v.sort(function(a,b){return a-b});return!0};a.removeProtectedStep=function(a){if(!C)return!1;a=parseInt(a);if(a!==a)return!1;a=v.indexOf(a);if(-1==a)return!1;v.splice(a,1);return!0};a.getProtectedSteps=function(){return C?v.concat():null};var T=b.pushStack=function(b){z.length=
c+1;for(var d=u.length-1;0<d;--d)if(u[d].beginStep>c)--u.length;else break;var g;if(b.srcBlob){g={crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:b.srcBlob,saveFormat:b.saveFormat};for(d=0;u.length>=a.stepImgsGCThreshold;)if(v.filter(function(a){return u[d].beginStep<=a&&a<u[d].endStep}).length){if(!(++d<u.length))break}else{b=u[d].endStep;for(var e=u[d].beginStep;e<b;++e)z[e]=null;u.splice(d,1)}z.push(g);++c;u.push({blob:g.srcBlob,beginStep:c,endStep:c+1})}else{g=
z[c];var f=g.crop,p=b.transform,l=b.crop,e={};b=p?p:g.transform;e.left=f.left;e.top=f.top;e.width=f.width;e.height=f.height;0!=b.a*b.d&&0==b.b*b.c?(p&&(b=new kUtil.Matrix(Math.sign(p.a),0,0,Math.sign(p.d),0,0)),l&&(e.left=1==b.a?e.left+l.left*f.width:e.left+(1-l.left-l.width)*f.width,e.top=1==b.d?e.top+l.top*f.height:e.top+(1-l.top-l.height)*f.height,e.width*=l.width,e.height*=l.height)):(p&&(b=new kUtil.Matrix(0,Math.sign(p.b),Math.sign(p.c),0,0,0)),l&&(e.left=1==b.b?e.left+l.top*f.width:e.left+
(1-l.top-l.height)*f.width,e.top=1==b.c?e.top+l.left*f.height:e.top+(1-l.left-l.width)*f.height,e.width*=l.height,e.height*=l.width));f=n[h];f=Math.pow(10,Math.ceil(Math.max(f.kPainterWidth,f.kPainterHeight)).toString().length+2);e.left=Math.round(e.left*f)/f;e.top=Math.round(e.top*f)/f;e.width=Math.round(e.width*f)/f;e.height=Math.round(e.height*f)/f;g={crop:e,transform:b,srcBlob:g.srcBlob,saveFormat:g.saveFormat};z.push(g);++c;g.srcBlob&&(u[u.length-1].endStep=c+1)}};a.undo=function(a){if(!C)w(a,
[!1]);else if(0<c){for(var b=c-1;null==z[b];)--b;I(c,b,function(){w(a,[!0])})}};a.redo=function(a){if(!C)w(a,[!1]);else if(c<z.length-1){for(var b=c+1;null==z[b];)++b;I(c,b,function(){w(a,[!0])})}};a.getStepCount=function(){return C?z.length:NaN};a.getCurStep=function(){return C?c:NaN};a.setCurStepAsync=function(a,b){1>arguments.length||isNaN(a)?w(b,[!1]):(a=Math.round(a),0>a||a>=z.length||null==z[a]?w(b,[!1]):I(c,a,function(){w(b,[!0])}))};b.needAlwaysTrueTransform=!1;var I=function(a,g,m){c=g;g=
z[a].crop;var e=z[c].crop;g.left==e.left&&g.top==e.top&&g.width==e.width&&g.bottom==e.bottom&&z[a].srcBlob==z[c].srcBlob?($(d).setTransform(z[c].transform.dot(z[a].transform.inversion()).dot($(d).getTransform())),R.setImgStyleFit(),m&&m()):M(b.needAlwaysTrueTransform,!1,m)},H=function(b){$(d).siblings().hide();M(!1,!1,function(){a.isAutoShowCropUI&&X.showCropRect();b&&b()})},K;K=Math.min(screen.width,screen.height)*(window.devicePixelRatio||1);var M=b.updateCvsAsync=function(a,b,g){$(d).hide();var e=
z[c],f=e.srcBlob||n[h].kPainterOriBlob,p=function(){var c=URL.createObjectURL(f),d=new Image;d.onload=d.onerror=function(){d.onload=d.onerror=null;O(d,e,a,b);URL.revokeObjectURL(c);g&&g()};d.src=c};window.createImageBitmap?createImageBitmap(f).then(function(c){O(c,e,a,b);g&&g()})["catch"](function(){p()}):p()},O=function(b,c,g,e){a._noAnyUseButForIosSafariBug0=b.naturalWidth;a._noAnyUseButForIosSafariBug1=b.naturalHeight;var f=b.naturalWidth||b.width,p=b.naturalHeight||b.height,l=c.crop;c=c.transform;
var q=d.getContext("2d"),k=d.fullQualityWidth=Math.round(f*l.width)||1,J=d.fullQualityHeight=Math.round(p*l.height)||1,m=!1;0!=c.a*c.d&&0==c.b*c.c?(d.fullQualityWidth=k,d.fullQualityHeight=J):(d.fullQualityWidth=J,d.fullQualityHeight=k,g&&(m=!0));d.hasCompressed=!1;if(g){var N,h;m?(N=J,h=k):(N=k,h=J);d.width=N;d.height=h;q.setTransform(c.a,c.b,c.c,c.d,N/2*(1-c.a-c.c),h/2*(1-c.b-c.d))}else k>K||J>K?(N=K/Math.max(k,J),d.width=Math.round(k*N)||1,d.height=Math.round(J*N)||1,d.hasCompressed=!0):(d.width=
k,d.height=J);N=Math.round(f*l.left);l=Math.round(p*l.top);N==f&&--N;l==p&&--l;m?(f=d.height,p=d.width):(f=d.width,p=d.height);if(2>=k/f)q.drawImage(b,N,l,k,J,0,0,f,p);else{m=document.createElement("canvas");m.width=Math.round(k/2);m.height=Math.round(J/2);h=m.getContext("2d");var V=Math.round(k/2),x=Math.round(J/2);for(h.drawImage(b,N,l,k,J,0,0,V,x);;){b=V;k=x;V=Math.round(b/2);x=Math.round(k/2);if(V<=f||x<=p)break;h.drawImage(m,0,0,b,k,0,0,V,x)}q.drawImage(m,0,0,b,k,0,0,f,p)}g?$(d).setTransform(new kUtil.Matrix(1,
0,0,1,0,0)):$(d).setTransform(c);e||(R.setImgStyleFit(),$(d).show())};a.enterEditAsync=function(a){if(C||-1==h)w(a,[!1]);else{P="";W();C=!0;var b=n[h].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};z.push(b);c=0;H(function(){m();F=A=null;P="basicEdit";w(a,[!0])})}};var Q=a.cancelEdit=function(){if(!C)return!1;C=!1;z.length=0;u.length=0;y.showImg(h);$(d).hide();X.hideCropRect();Z.hideFreeTransformBorderDirectly();F=A=null;
P="view";return!0},G=function(a,b){var k=z[c].crop,e=z[c].transform,f=z[0].crop,p=z[0].transform,l=n[h];if(z[c].srcBlob||p.a!=e.a||p.b!=e.b||p.c!=e.c||p.d!=e.d||Math.round(l.kPainterOriWidth*k.left)!=Math.round(l.kPainterOriWidth*f.left)||Math.round(l.kPainterOriHeight*k.top)!=Math.round(l.kPainterOriHeight*f.top)||Math.round(l.kPainterOriWidth*(k.left+k.width))!=Math.round(l.kPainterOriWidth*(f.left+f.width))||Math.round(l.kPainterOriHeight*(k.top+k.height))!=Math.round(l.kPainterOriHeight*(f.top+
f.height))){URL.revokeObjectURL(l.src);var q=new Image,k=function(){q.onload=q.onerror=function(){q.onload=q.onerror=null;b?($(n[h]).remove(),n.splice(h,1,q)):n.splice(++h,0,q);B.children(".kPainterImgsDiv").append(q);a&&a()};g(d,function(a){q.kPainterBlob=a;q.kPainterWidth=d.width;q.kPainterHeight=d.height;z[c].srcBlob?(q.kPainterOriBlob=a,q.kPainterOriWidth=d.width,q.kPainterOriHeight=d.height,q.kPainterSaveFormat=z[c].saveFormat):(q.kPainterOriBlob=l.kPainterOriBlob,q.kPainterOriWidth=l.kPainterOriWidth,
q.kPainterOriHeight=l.kPainterOriHeight,q.kPainterProcess=z[c],q.kPainterSaveFormat=l.kPainterSaveFormat);a=URL.createObjectURL(a);q.src=a},z[c].saveFormat||l.kPainterSaveFormat)};d.hasCompressed||1!=e.a||0!=e.b||0!=e.c||1!=e.d||0!=e.e||0!=e.f?($(d).hide(),M(!0,!0,k)):k()}else a()},E=!1;a.saveEditAsync=function(b,c){!C||E?w(b,[!1]):(P="",E=!0,W(),setTimeout(function(){G(function(){Q();m();E=!1;F=A=null;try{(function(){for(var b=0;b<y.thumbnailBoxArr.length;++b){var e=y.thumbnailBoxArr[b],f=n[h];a._noAnyUseButForIosSafariBug0=
f.naturalWidth;a._noAnyUseButForIosSafariBug1=f.naturalHeight;var d=Math.min(e.kPainterMaxWH/f.naturalWidth,e.kPainterMaxWH/f.naturalHeight,1),l;c?(l=$(e.kPainterThumbBoxArr[h]),l=l.hasClass("kPainterThumbnailCanvas")?l[0]:l.find(".kPainterThumbnailCanvas")[0]):(l=document.createElement("canvas"),l.className="kPainterThumbnailCanvas");l.width=Math.round(f.naturalWidth*d);l.height=Math.round(f.naturalHeight*d);l.getContext("2d").drawImage(f,0,0,l.width,l.height);if(!c){f=e.kPainterFunWrap;d=null;try{d=
f?f(l):l}catch(q){return setTimeout(function(){throw q;},0),!1}d&&(d.getKPainterIndex=function(){return e.kPainterThumbBoxArr.indexOf(this)},e.kPainterThumbBoxArr.splice(h,0,d),$(e.kPainterThumbBoxArr[h-1]).after(d))}}})()}catch(t){setTimeout(function(){throw t;},0)}P="view";w(b,[!0])},c)},100))};a.rotateRight=function(){if(!C)return!1;var a=$(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,1,-1,0,0,0),a);$(d).setTransform(a);T({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;
d.fullQualityHeight=a;R.setImgStyleFit();return!0};a.rotateLeft=function(){if(!C)return!1;var a=$(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,-1,1,0,0,0),a);$(d).setTransform(a);T({transform:a});a=d.fullQualityWidth;d.fullQualityWidth=d.fullQualityHeight;d.fullQualityHeight=a;R.setImgStyleFit();return!0};a.mirror=function(){if(!C)return!1;var a=$(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(-1,0,0,1,0,0),a);$(d).setTransform(a);T({transform:a});R.setImgStyleFit();return!0};a.flip=
function(){if(!C)return!1;var a=$(d).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(1,0,0,-1,0,0),a);$(d).setTransform(a);T({transform:a});R.setImgStyleFit();return!0};a.resizeAsync=function(a,c,h){if(!C)return w(h,[!1]);a=parseInt(a);c=parseInt(c);if(a!==a||1>a||c!==c||1>c)return w(h,[!1]);W();b.updateCvsAsync(!0,!0,function(){b.needAlwaysTrueTransform=!0;for(var e=a,f=c;2*e<d.width;)e*=2;for(;2*f<d.height;)f*=2;for(var p=d,l;;){l=document.createElement("canvas");l.width=e;l.height=f;l.getContext("2d").drawImage(p,
0,0,e,f);var q=!1;a!=e&&(e/=2,q=!0);c!=f&&(f/=2,q=!0);if(!q)break}g(l,function(a){b.pushStack({srcBlob:a,saveFormat:"image/jpeg"});b.updateCvsAsync(!1,!1,function(){b.needAlwaysTrueTransform=!1;m();w(h,[!0])})})})};a.getEditWidth=function(){return C?d.fullQualityWidth:NaN};a.getEditHeight=function(){return C?d.fullQualityHeight:NaN}},X=new function(){var b=this;a.isAutoShowCropUI=!0;var c=B.children(".kPainterCroper");b.isCropRectShowing=!1;a.showCropRect=b.showCropRect=function(){C&&(b.isCropRectShowing=
!0,N(),c.show())};a.hideCropRect=b.hideCropRect=function(){b.isCropRectShowing=!1;c.hide()};c.css({"border-left-width":"100000px","border-top-width":"100000px","border-right-width":"100000px","border-bottom-width":"100000px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"});a.setCropRectStyle=function(a){switch(parseInt(a)){case 0:return c.find(">.kPainterBigMover").hide(),c.find(">.kPainterMover").show(),!0;case 1:return c.find(">.kPainterMover").hide(),c.find(">.kPainterBigMover").show(),
!0;default:return!1}};var g,m,h,n,v,y,K,M,O,Q,G,E,x,k,t,e,f,p,l,q;a.cropRectMinW=50;a.cropRectMinH=50;var L=function(){"crop"==F&&(F=A=null)},J=function(){y=B.contentBoxRect();var a=$(d).getTransform(),b=parseFloat(d.style.left)+1E5,g=parseFloat(d.style.top)+1E5;0!=a.a*a.d&&0==a.b*a.c?(G=parseFloat(d.style.width),E=parseFloat(d.style.height)):(G=parseFloat(d.style.height),E=parseFloat(d.style.width));var a=G/2,J=E/2;K=b-a;M=g-J;O=b+a;Q=g+J;t=parseFloat(c[0].style.width);e=parseFloat(c[0].style.height);
x=parseFloat(c[0].style.left)-t/2+1E5;k=parseFloat(c[0].style.top)-e/2+1E5;f=Math.max(-y.width/2,K);p=Math.max(-y.height/2,M);l=Math.min(y.width/2,O);q=Math.min(y.height/2,Q)};B.find("> .kPainterCroper > .kPainterEdges > div, > .kPainterCroper > .kPainterCorners > div, > .kPainterCroper > .kPainterMover, > .kPainterCroper > .kPainterBigMover").on("touchstart touchcancel touchend mousedown",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if(!A)A="mouse";else if("mouse"!=A)return;
b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;1==b.length?null==F&&(F="crop",h=b[0].identifier,g=b[0].pageX,m=b[0].pageY,a=$(this).attr("data-orient").split(","),n=a[0],v=a[1],J()):0==b.length&&L()});B.on("mouseup",function(){"mouse"==A&&L()});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&L()});a.onCropRectChange=null;var aa=function(){c[0].style.left=x+t/2-1E5+"px";c[0].style.right=-x-t/2-1E5+"px";
c[0].style.top=k+e/2-1E5+"px";c[0].style.bottom=-k-e/2-1E5+"px";c[0].style.width=t+"px";c[0].style.height=e+"px";w(a.onCropRectChange)};B.on("touchmove mousemove",function(b){b.preventDefault();var c=b.originalEvent.targetTouches;if(!c){if("mouse"!=A)return;c=[{pageX:b.originalEvent.clientX,pageY:b.originalEvent.clientY}]}else if("touch"!=A)return;if(1==c.length&&"crop"==F&&h==c[0].identifier){var d=g;b=m;g=c[0].pageX;m=c[0].pageY;c=g-d;b=m-b;-1==n?(t-c<a.cropRectMinW&&(c=t-a.cropRectMinW),x+c<f&&
(c=f-x),t-=c,x+=c):1==n&&(t+c<a.cropRectMinW&&(c=-t+a.cropRectMinW),x+t+c>l&&(c=l-t-x),t+=c);-1==v?(e-b<a.cropRectMinH&&(b=e-a.cropRectMinH),k+b<p&&(b=p-k),e-=b,k+=b):1==v&&(e+b<a.cropRectMinH&&(b=-e+a.cropRectMinH),k+e+b>q&&(b=q-e-k),e+=b);0==n&&0==v&&(x+c<f?c=f-x:x+t+c>l&&(c=l-t-x),k+b<p?b=p-k:k+e+b>q&&(b=q-e-k),x+=c,k+=b);aa()}});var N=a.setCropRectArea=function(a,c,d,g){if(!b.isCropRectShowing)return!1;-.5<=a||(a=-.5);-.5<=c||(c=-.5);.5>=d||(d=.5);.5>=g||(g=.5);a>d&&(a=d=(a+d)/2);c>g&&(c=g=(c+
g)/2);J();x=K+(a+.5)*G;x<f&&(x=f);k=M+(c+.5)*E;k<p&&(k=p);a=K+(d+.5)*G;a>l&&(a=l);t=a-x;g=M+(g+.5)*E;g>q&&(g=q);e=g-k;aa();return!0},Y=a.getCropRectArea=function(a){if(!b.isCropRectShowing)return null;var c=$(d).getTransform();(0!=c.a*c.d&&0==c.b*c.c?parseFloat(d.style.width):parseFloat(d.style.height))!=G&&J();var c=(x-K)/G-.5,f=(k-M)/E-.5,g=c+t/G,l=f+e/E;a&&(c=Math.round(c*d.fullQualityWidth*2)/2,f=Math.round(f*d.fullQualityHeight*2)/2,g=Math.round(g*d.fullQualityWidth*2)/2,l=Math.round(l*d.fullQualityHeight*
2)/2);return[c,f,g,l]};b.getNeededRect=function(){J();var a={};a.width=2*Math.max(-x,x+t);a.height=2*Math.max(-k,k+e);return a};a.cropAsync=function(a,b){if(C)if(J(),b=b||Y()){var c=b[0],e=b[1],f=b[2],g=b[3];.5>(c+.5)*d.fullQualityWidth&&.5>=(.5-f)*d.fullQualityWidth&&.5>(e+.5)*d.fullQualityHeight&&.5>=(.5-g)*d.fullQualityHeight?w(a,[c,e,f,g]):(U.pushStack({crop:{left:c+.5,top:e+.5,width:f-c,height:g-e}}),U.updateCvsAsync(U.needAlwaysTrueTransform,!1,function(){w(a,[c,e,f,g])}))}else w(a,[null]);
else w(a,[null])}},Z=new function(){var b=this;(function(){var c=Math.PI/180,h=Math.PI/6,n=Math.PI/18,r=function(a){var b=d.width,c=d.height,e;b>c?b>a&&(e=a/b,b=a,c=Math.round(c*e)||1):c>a&&(e=a/c,c=a,b=Math.round(b*e)||1);a=$(d).getTransform();var g;0!=a.a*a.d&&0==a.b*a.c?(e=b,g=c):(e=c,g=b);var k=document.createElement("canvas");k.width=e;k.height=g;k=k.getContext("2d");k.setTransform(a.a,a.b,a.c,a.d,e/2*(1-a.a-a.c),g/2*(1-a.b-a.d));k.drawImage(d,0,0,b,c);return k.getImageData(0,0,e,g)},T=function(b,
c,d){if("string"==typeof b||b instanceof String||b instanceof Blob)y.getBlobAndFormatFromAnyImgData(b,function(a){a?v(a,null,function(a){T(a,c,d)}):d(null)});else if(b instanceof Image)try{a._noUseButTestSrc=b.src}catch(N){setTimeout(function(a){throw a;},0);d(null);return}else if(b instanceof ImageData){if(b.width<=c&&b.height<=c){setTimeout(function(){d(b)},0);return}var e=b;b=document.createElement("canvas");b.width=e.width;b.height=e.height;b.getContext("2d").putImageData(e,b.width,b.height)}var f=
document.createElement("canvas"),e=b.naturalWidth||b.videoWidth||b.width,g=b.naturalHeight||b.videoHeight||b.height,p=1;e>g?e>c&&(p=c/e,e=c,g=Math.round(g*p)||1):g>c&&(p=c/g,g=c,e=Math.round(e*p)||1);f.width=e;f.height=g;var k=f.getContext("2d");k.drawImage(b,0,0,f.width,f.height);setTimeout(function(){d(k.getImageData(0,0,f.width,f.height))},0)};a.documentDetectAsync=function(a,b){if(!b){if("perspect"!=F){w(a,[null]);return}W()}var e=KPainter._cv;T(b||r(256),256,function(f){var d=new e.matFromArray(f,
e.CV_8UC4);f=d.cols;var g=d.rows,l=Math.min(d.cols,d.rows);e.cvtColor(d,d,e.ColorConversionCodes.COLOR_RGBA2GRAY.value,0);var k=new e.Mat;e.GaussianBlur(d,k,[5,5],0,0,e.BORDER_DEFAULT);e.delMat(d);d=new e.Mat;e.Canny(k,d,8,.5*l,3,!1);e.delMat(k);var p=new e.Mat;e.HoughLinesP(d,p,1,c,8,8,3);e.delMat(d);for(var r=p.data32s(),u=[],d=f/2,x=g/2,k=0;k<r.length;k+=2)u.push(r[k]-d),u.push(r[k+1]-x);e.delMat(p);for(var t=[],k=0;k<u.length;k+=4){var p=u[k+0],v=u[k+1],A=u[k+2],D=u[k+3],y=v-D,B=A-p,r=p*D-A*v;
if(0!=r){var z=0>r?-1:1,C=Math.sqrt(y*y+B*B),y=y/C*z,B=B/C*z,r=r/C*z,z=Math.atan(y/B),C=Math.abs(z);C>h&&C<Math.PI/2-h||(0>B?0==y?(B=-1,z=0):z=-z:0<B?0>y?z=-Math.PI-z:0<y?z=Math.PI-z:(B=1,z=Math.PI):0<y?(y=1,z=Math.PI/2):(y=-1,z=-Math.PI/2),p=Math.sqrt((A-p)*(A-p)+(D-v)*(D-v)),t.push([y,B,r,z,p]))}}k=[];u=[];I(t,k,2,n,.7*l);I(k,u,2,n,.7*l);l=[null,null,null,null];for(k=0;k<u.length;++k)t=u[k],z=t[3],v=z<3*-Math.PI/4?0:z<-Math.PI/4?1:z<Math.PI/4?2:z<3*Math.PI/4?3:0,l[v]?(p=l[v],z=p[2],y=p[4],r=t[2],
p=t[4],r*p>z*y&&(l[v]=t)):l[v]=t;for(k=0;k<l.length;++k)t=l[k],null==t&&(t=[],l[k]=t,0==k?(t[2]=x,t[3]=Math.PI):1==k?(t[2]=d,t[3]=-Math.PI/2):2==k?(t[2]=x,t[3]=0):3==k&&(t[2]=d,t[3]=Math.PI/2)),t[0]=Math.sin(t[3]),t[1]=-Math.cos(t[3]);d=[];for(k=0;k<l.length;++k)u=l[k],p=l[(k-1+l.length)%l.length],x=u[0],r=u[1],u=u[2],t=p[0],v=p[1],z=p[2],p=(r*z-v*u)/(v*x-r*t),v=(x*z-t*u)/(t*r-x*v),d.push([p/f,v/g]);b||(M(d),m());w(a,[d])})};var I=function(a,b,c,d,g){for(var e=0;e<a.length;++e){for(var f=a[e],l=!1,
k=0;k<b.length;++k){var p=b[k],q=p[3],m=f[3],h=q-m;h>Math.PI?m+=2*Math.PI:h<-Math.PI&&(m-=2*Math.PI);h=Math.abs(p[2]-f[2]);if(Math.abs(q-m)<d&&h<c){var l=!0,h=p[4],n=f[4],k=h+n;p[2]=(p[2]*h+f[2]*n)/k;q=(q*h+m*n)/k;q>Math.PI?q-=2*Math.PI:q<=-Math.PI&&(q+=2*Math.PI);p[3]=q;p[4]=Math.min(k,g);break}}l||b.push([null,null,f[2],f[3],f[4]])}},H=B.children(".kPainterPerspect");b.hideFreeTransformBorderDirectly=function(){H.hide()};var K=B.find("> .kPainterPerspect > .kPainterPerspectCvs")[0];a.onFreeTransformCornerPosChange=
null;var M=a.setFreeTransformCornerPos=function(a){if("perspect"==F){var b=d.kPainterZoom,c=$(d).getTransform(),e=d.width*b,b=d.height*b;if(0==c.a*c.d||0!=c.b*c.c)c=e,e=b,b=c;for(var g=B.borderBoxRect(),c=g.width/2-5,g=g.height/2-5,k=0;k<G.length;++k){var m=G[k],h=$(m).attr("data-index"),n=a[h],h=e*n[0],n=b*n[1];h<-c?h=-c:h>c&&(h=c);n<-g?n=-g:n>g&&(n=g);m.style.left=h+"px";m.style.right=-h+"px";m.style.top=n+"px";m.style.bottom=-n+"px"}Q();H.show()}},O=a.getFreeTransformCornerPos=function(){var a=
d.kPainterZoom,b=$(d).getTransform(),c=d.width*a,a=d.height*a;if(0==b.a*b.d||0!=b.b*b.c)b=c,c=a,a=b;for(var b=[],g=0;g<G.length;++g){var k=G[g];b.push([parseFloat(k.style.left)/c,parseFloat(k.style.top)/a])}return b},Q=function(){var b=B.borderBoxRect();K.width=Math.round(b.width);K.height=Math.round(b.height);for(var c=[],d=0;d<G.length;++d)c.push([Math.round(parseFloat(G[d].style.left)+b.width/2),Math.round(parseFloat(G[d].style.top)+b.height/2)]);for(var b=K.getContext("2d"),g=Number.POSITIVE_INFINITY,
k,d=0;4>d;++d){var m=c[d][0]*c[d][0]+c[d][1]*c[d][1];m<g&&(g=m,k=d)}for(var h=[],d=0;4>d;++d)h.push([c[(k+d)%4][0],c[(k+d)%4][1]]);b.fillStyle="rgba(0,0,0,0.3)";b.beginPath();b.moveTo(0,0);b.lineTo(h[0][0],h[0][1]);k=function(a,b,c,d,e,f,g,k){return[Math.sign((d-b)*e+(a-c)*f+c*b-a*d),Math.sign((d-b)*g+(a-c)*k+c*b-a*d)]};c=[];for(d=0;4>d;++d)c.push(k(h[d][0],h[d][1],h[(d+1)%4][0],h[(d+1)%4][1],h[(d+2)%4][0],h[(d+2)%4][1],h[(d+3)%4][0],h[(d+3)%4][1]));d=function(a,b,c,d,e,f,g,k){var h=d-b,l=a-c;a=c*
b-a*d;b=k-f;c=e-g;e=g*f-e*k;f=l*b-c*h;return[(a*c-e*l)/f,(e*h-a*b)/f]};k=void 0;g=function(){var a,b,c=h[1][0]-h[0][0];c&&(a=(h[1][1]-h[0][1])/c);var d=h[3][0]-h[0][0];d&&(b=(h[3][1]-h[0][1])/d);return 0<c?0<d?a<=b:!0:0==c?0<d?!1:!0:0<=d?!1:a<=b}();0>c[0][0]*c[0][1]?0>c[2][0]*c[2][1]&&(k=d(h[0][0],h[0][1],h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1]),g?(b.lineTo(k[0],k[1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[1][0],h[1][1]),b.lineTo(k[0],k[1]),b.lineTo(h[3][0],h[3][1])):(b.lineTo(h[3][0],h[3][1]),
b.lineTo(k[0],k[1]),b.lineTo(h[1][0],h[1][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(k[0],k[1]))):0>c[1][0]*c[1][1]&&0>c[3][0]*c[3][1]&&(k=d(h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1],h[0][0],h[0][1]),g?(b.lineTo(h[1][0],h[1][1]),b.lineTo(k[0],k[1]),b.lineTo(h[3][0],h[3][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(k[0],k[1])):(b.lineTo(k[0],k[1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[3][0],h[3][1]),b.lineTo(k[0],k[1]),b.lineTo(h[1][0],h[1][1])));k||(g?(b.lineTo(h[1][0],h[1][1]),b.lineTo(h[2][0],h[2][1]),
b.lineTo(h[3][0],h[3][1])):(b.lineTo(h[3][0],h[3][1]),b.lineTo(h[2][0],h[2][1]),b.lineTo(h[1][0],h[1][1])));b.lineTo(h[0][0],h[0][1]);b.lineTo(0,0);b.lineTo(0,K.height);b.lineTo(K.width,K.height);b.lineTo(K.width,0);b.lineTo(0,0);b.fill();w(a.onFreeTransformCornerPosChange)},G=B.find("> .kPainterPerspect > .kPainterPerspectCorner");G.css("left","0");G.css("top","0");G.css("right","0");G.css("bottom","0");var E=null,x,k,t;G.on("touchstart touchcancel touchend mousedown",function(a){t=this;a.preventDefault();
var b=a.originalEvent.targetTouches;if(!b){if(!A)A="mouse";else if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!A)A="touch";else if("touch"!=A)return;a=function(){var a=H.width()/2-5,b=H.height()/2-5,c=parseFloat(t.style.left),d=parseFloat(t.style.top),e=!0,f=!0;c<-a?c=-a:c>a?c=a:e=!1;d<-b?d=-b:d>b?d=b:f=!1;e&&(t.style.left=c+"px",t.style.right=-c+"px");f&&(t.style.top=d+"px",t.style.bottom=-d+"px");(e||f)&&Q()};1==b.length?("perspect"==
F&&(F="perspectCornerMoving"),a(),E=b[0].identifier,x=b[0].pageX,k=b[0].pageY):0==b.length&&"perspectCornerMoving"==F&&(a(),A=null,F="perspect")});B.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=A)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=A)return;if(1==b.length&&"perspectCornerMoving"==F&&E==b[0].identifier){var c=x;a=k;x=b[0].pageX;k=b[0].pageY;b=x-c;a=k-a;b=parseFloat(t.style.left)+
b;a=parseFloat(t.style.top)+a;t.style.left=b+"px";t.style.right=-b+"px";t.style.top=a+"px";t.style.bottom=-a+"px";Q()}});B.on("mouseup",function(){"mouse"==A&&"perspectCornerMoving"==F&&(A=null,F="perspect")});B.on("mouseleave",function(a){"mouse"==A&&a.originalEvent.buttons&&"perspectCornerMoving"==F&&(A=null,F="perspect")});a.freeTransformMaxWH=2048;a.freeTransformAsync=function(b,c,k){if(k||"perspect"==F){W();var e=KPainter._cv,f=c=c||O();.005>Math.abs(f[0][0]-.5)&&.005>Math.abs(f[0][1]-.5)&&.005>
Math.abs(f[1][0]+.5)&&.005>Math.abs(f[1][1]-.5)&&.005>Math.abs(f[2][0]+.5)&&.005>Math.abs(f[2][1]+.5)&&.005>Math.abs(f[3][0]-.5)&&.005>Math.abs(f[3][1]+.5)?(m(),k?w(b,[null]):w(b,[!0])):T(k||r(a.freeTransformMaxWH),a.freeTransformMaxWH,function(a){a=new e.matFromArray(a,e.CV_8UC4);e.cvtColor(a,a,e.ColorConversionCodes.COLOR_RGBA2RGB.value,0);for(var f=new e.Mat.zeros(4,1,e.CV_32FC2),h=f.data32f(),l=0;l<c.length;++l){var p=c[l];h[2*l]=Math.round((p[0]+.5)*a.cols);h[2*l+1]=Math.round((p[1]+.5)*a.rows)}var n=
h[2]-h[0],q=h[3]-h[1],p=h[4]-h[2],l=h[5]-h[3],t=h[6]-h[4],u=h[7]-h[5],r=h[0]-h[6],z=h[1]-h[7],h=Math.round(Math.max(Math.sqrt(n*n+q*q),Math.sqrt(t*t+u*u))),p=Math.round(Math.max(Math.sqrt(p*p+l*l),Math.sqrt(r*r+z*z))),r=new e.Mat.zeros(4,1,e.CV_32FC2),l=r.data32f();l[2]=h;l[4]=h;l[5]=p;l[7]=p;l=e.getPerspectiveTransform(f,r);e.delMat(f);e.delMat(r);f=new e.Mat.zeros(p,h,e.CV_8UC3);r=new e.Scalar(0,255,0);e.warpPerspective(a,f,l,[f.rows,f.cols],e.InterpolationFlags.INTER_LINEAR.value,e.BORDER_CONSTANT,
r);e.delMat(a);e.delMat(l);e.delMat(r);a=new ImageData(h,p);r=f.channels();n=f.data();for(q=l=0;l<n.length;l+=r,q+=4)a.data[q]=n[l],a.data[q+1]=n[l+1%r],a.data[q+2]=n[l+2%r],a.data[q+3]=255;e.delMat(f);d.width=h;d.height=p;d.getContext("2d").putImageData(a,0,0);R.setImgStyleFit();g(d,function(a){k?w(b,[a]):(U.pushStack({srcBlob:a,saveFormat:"image/jpeg"}),U.updateCvsAsync(!0,!1,function(){M([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);F="perspect";m();w(b,[!0])}))},"image/jpeg")})}else w(b,[!1])};a.enterFreeTransformModeAsync=
function(a){C&&KPainter.cvHasLoaded?(P="",A=null,F="perspect",W(),setTimeout(function(){X.hideCropRect();U.updateCvsAsync(!0,!1,function(){M([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);H.show();m();U.needAlwaysTrueTransform=!0;w(a,[!0]);P="freeTransform"})},0)):w(a,[!1])};a.exitFreeTransformModeAsync=function(b){"perspect"!=F?w(b,[!1]):(P="",H.hide(),U.updateCvsAsync(!1,!1,function(){a.isAutoShowCropUI&&X.showCropRect();F=A=null;U.needAlwaysTrueTransform=!1;P="basicEdit";w(b,[!0])}))}})()};new function(){a.videoHtmlElement=
$('<div class="kPainterVideoMdl" style="display:none;"><video class="kPainterVideo" webkit-playsinline="true"></video><select class="kPainterCameraSelect"></select><select class="kPainterResolutionSelect"><option class="kPainterGotResolutionOpt" value="got" selected></option><option data-width="3840" data-height="2160">ask 3840 x 2160</option><option data-width="1920" data-height="1080">ask 1920 x 1080</option><option data-width="1600" data-height="1200">ask 1600 x 1200</option><option data-width="1280" data-height="720">ask 1280 x 720</option><option data-width="800" data-height="600">ask 800 x 600</option><option data-width="640" data-height="480">ask 640 x 480</option><option data-width="640" data-height="360">ask 640 x 360</option></select><button class="kPainterBtnGrabVideo"><svg width="48" viewBox="0 0 2048 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"/></svg></button><button class="kPainterBtnCloseVideo"><svg width="48" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button></div>')[0];
a.videoSettings={video:{facingMode:{ideal:"environment"}}};a.beforeAddImgFromGrabVideoBtn=null;a.afterAddImgFromGrabVideoBtn=null;a.grabVideo=null;a.hideVideo=null;a.showVideo=function(b){a.hideVideo&&a.hideVideo();var c=$(a.videoHtmlElement).find(".kPainterVideo")[0],d=$(a.videoHtmlElement).find(".kPainterCameraSelect")[0],g=$(a.videoHtmlElement).find(".kPainterResolutionSelect")[0],h=$(a.videoHtmlElement).find(".kPainterGotResolutionOpt")[0],m=$(a.videoHtmlElement).find(".kPainterBtnGrabVideo")[0],
n=$(a.videoHtmlElement).find(".kPainterBtnCloseVideo")[0],r=function(){return d?navigator.mediaDevices.enumerateDevices().then(function(a){var b=d.value;d.innerHTML="";for(var e=void 0,f=0;f<a.length;++f){var g=a[f];if("videoinput"==g.kind){var h=document.createElement("option");h.value=g.deviceId;h.innerText=g.label||"camera "+f;d.appendChild(h);b==g.deviceId&&(e=h)}}var k=d.childNodes;if(!e&&k.length)try{c.srcObject.getTracks().forEach(function(a){if("video"==a.kind)for(var b=0;b<k.length;++b){var c=
k[b];if(a.label==c.innerText)throw e=c,"found the using source";}})}catch(L){self.kConsoleLog&&self.kConsoleLog(L)}e&&(d.value=e.value)}):Promise.reject("no camera select")},v=function(){c.srcObject&&(self.kConsoleLog&&self.kConsoleLog("======stop video========"),c.srcObject.getTracks().forEach(function(a){a.stop()}))},y=function(k){return new Promise(function(m,e){v();self.kConsoleLog&&self.kConsoleLog("======before video========");var f=b?b:a.videoSettings,n=g?$(g).children(":selected")[0]:null;
if(n&&n.hasAttribute("data-width")){var l=n.getAttribute("data-width"),n=n.getAttribute("data-height");h.setAttribute("data-width",l);h.setAttribute("data-height",n);/Safari/.test(navigator.userAgent)&&/iPhone/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)?1280<=l?f.video.width=1280:640<=l?f.video.width=640:320<=l&&(f.video.width=320):(f.video.width={ideal:l},f.video.height={ideal:n});!k&&(l=$(d).children(":selected")[0])&&(k=l.value);k&&(f.video.facingMode=void 0,f.video.deviceId=
{exact:k})}var q=!1,r=function(){self.kConsoleLog&&self.kConsoleLog("======try getUserMedia========");self.kConsoleLog&&self.kConsoleLog("ask "+JSON.stringify(f.video.width)+"x"+JSON.stringify(f.video.height));navigator.mediaDevices.getUserMedia(f).then(function(a){self.kConsoleLog&&self.kConsoleLog("======get video========");return new Promise(function(b,d){c.srcObject=a;c.onloadedmetadata=function(){self.kConsoleLog&&self.kConsoleLog("======play video========");c.play().then(function(){self.kConsoleLog&&
self.kConsoleLog("======played video========");var a=c.videoWidth+"x"+c.videoHeight;h&&(h.innerText=a);g&&(g.value="got");self.kConsoleLog&&self.kConsoleLog(a);b()},function(a){d(a)})};c.onerror=function(){d()}})}).then(function(){m()})["catch"](function(a){self.kConsoleLog&&self.kConsoleLog(a);q?e(a):(q=!0,f.video.width=void 0,f.video.height=void 0,r())})};r()})},A=function(){y(d.value).then(function(){E&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};d&&d.addEventListener("change",
A);var B=function(){y().then(function(){E&&v()})["catch"](function(a){alert("Play video failed: "+(a.message||a))})};g&&g.addEventListener("change",B);a.grabVideo=function(b,d){var e=document.createElement("canvas");e.width=c.videoWidth;e.height=c.videoHeight;e.getContext("2d").drawImage(c,0,0);if(!b)return e;a.addImageAsync(e,d)};var C=function(){if(a.beforeAddImgFromGrabVideoBtn){var b=a.grabVideo();w(a.beforeAddImgFromGrabVideoBtn,[b,function(b){a.addImageAsync(b,a.afterAddImgFromGrabVideoBtn)}])}else a.grabVideo(!0,
a.afterAddImgFromGrabVideoBtn),a.hideVideo()};if(m)$(m).on("click touchstart",C);var E=!1,x=function(){v();E=!0;h.removeAttribute("data-width");var b=a.videoHtmlElement.parentNode;b&&b.removeChild(a.videoHtmlElement);d&&d.removeEventListener("change",A);g&&g.removeEventListener("change",B);m&&$(m).off("click touchstart",C);n&&$(n).off("click touchstart",x);a.grabVideo=null;a.hideVideo=null};a.hideVideo=x;if(n)$(n).on("click touchstart",x);document.body.appendChild(a.videoHtmlElement);return y().then(function(){if(E)return v(),
Promise.reject("Video window has closed.");r()["catch"](function(a){self.kConsoleLog&&kConsoleLog(a)});$(a.videoHtmlElement).show();return Promise.resolve()})}}};KPainter.cvFolder=void 0==KPainter.cvFolder?"js":KPainter.cvFolder;KPainter.cvHasLoaded=!1;KPainter._doCallbackNoBreak=function(b,a){if(b)try{b.apply(window,a||[])}catch(g){setTimeout(function(){throw g;},0)}};
KPainter.loadCvScriptAsync=function(b){KPainter._loadCvQueue=KPainter._loadCvQueue||new TaskQueue;KPainter._loadCvQueue.push(function(){if(KPainter.cvHasLoaded)KPainter._doCallbackNoBreak(b,[!0]),KPainter._loadCvQueue.next();else{KPainter._CVModule={cvFolder:KPainter.cvFolder,preRun:[],postRun:[],isRuntimeInitialized:!1,onRuntimeInitialized:function(){KPainter.cvHasLoaded=!0;self.kConsoleLog&&kConsoleLog("Runtime is ready!");KPainter._doCallbackNoBreak(b,[!0]);b=null;KPainter._loadCvQueue.next()},
onExit:function(){KPainter._doCallbackNoBreak(b,[!1]);b=null;KPainter._loadCvQueue.next()},onAbort:function(){KPainter._doCallbackNoBreak(b,[!1]);b=null;KPainter._loadCvQueue.next()},print:function(a){self.kConsoleLog&&kConsoleLog(a)},printErr:function(a){self.kConsoleLog&&kConsoleLog(a)},setStatus:function(a){self.kConsoleLog&&kConsoleLog(a)},totalDependencies:0};KPainter._CVModule.setStatus("Downloading...");var a=document.createElement("script");a.src=window.WebAssembly?KPainter.cvFolder+"/cv-wasm.js?v=20180921":
KPainter.cvFolder+"/cv.js?v=201800921";a.onerror=function(){KPainter._doCallbackNoBreak(b,[!1]);KPainter._loadCvQueue.next()};document.body.appendChild(a)}})};var MBC=KPainter;
