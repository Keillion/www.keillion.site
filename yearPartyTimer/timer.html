<!DOCTYPE html>
<html>
<head>
	<title>Year Party Timer</title>
	<meta charset="utf-8">
</head>
<body>
<style type="text/css">
	body{background:url('redSnow.jpg');color:#5de100;}
	.mainDiv{width:800px;height:500px;position:fixed;margin:auto;left:0;top:0;right:0;bottom:0;}
	label{font-weight:bold;}
	button{width:190px;height:48px;font-size:32px;}
</style>
<div class="mainDiv">
	<label>start: <input id="start"> ms;</label>
	<label>end: <input id="end"> ms;</label>
	<label>rate: <input id="rate"></label>
	<br><br>
	<button id="btn-countUp">Time CU</button>
	<button id="btn-2mCountDown">2m CD</button>
	<button id="btn-3mCountDown">3m CD</button>
	<button id="btn-countCustom">Custom</button>
	<br>
	<span id="time" style="font-size:200px;">00:00:00</span>
	<br>
	<button id="run" style="width:395px;">Run</button><button id="pause" style="display:none;width:395px;">Pause</button>
	<button id="recover" style="width:395px;">Recover</button>
	<audio id="audio-time-0" preload="auto" style="display:none;">
		<source src="pi.wav" type="audio/wav">
	</audio>
	<audio id="audio-time-1" preload="auto" style="display:none;">
		<source src="quiz1.wav" type="audio/wav">
	</audio>
	<audio id="audio-time-2" preload="auto" style="display:none;">
		<source src="decide1.wav" type="audio/wav">
	</audio>
</div>
<script src="jquery-3.2.1.slim.min.js"></script>
<script src="timer.js"></script>
<script type="text/javascript">
	$('#start').val(0);
	$('#end').val(Infinity);
	$('#rate').val(1);
	$('#btn-countUp').click(function(){
		$('#start').val(0);
		$('#end').val(Infinity);
		$('#rate').val(1);
		$('#time').text(getTimeStr(0));
		restarted = true;
	});
	$('#btn-2mCountDown').click(function(){
		$('#start').val(120000);
		$('#end').val(0);
		$('#rate').val(-1);
		$('#time').text(getTimeStr(120000));
		restarted = true;
	});
	$('#btn-3mCountDown').click(function(){
		$('#start').val(180000);
		$('#end').val(0);
		$('#rate').val(-1);
		$('#time').text(getTimeStr(180000));
		restarted = true;
	});
	$('#btn-countCustom').click(function(){
		$('#time').text(getTimeStr(parseInt($('#start').val())));
		restarted = true;
	});
	var restarted = true;
	var timer = new Timer( 0, Infinity, 1, function(time){
		$('#time').text(getTimeStr(time));
	});
	var PrefixInteger = function(num, n) {
        return (Array(n).join(0) + num).slice(-n);
    };
    var getTimeStr = function(time){
		var timeStr = [
			PrefixInteger(Math.floor(time / 60000), 2),
			PrefixInteger(Math.floor(time / 1000) % 60, 2),
			PrefixInteger(Math.floor(time / 10), 2)
		].join(':');
		return timeStr;
    };
    var lastCallAudioTime = -Infinity;
    //var lastCallAudioIndex = 0;
	$('#run').click(function(){
		if(restarted){
			timer = new Timer(
				parseFloat($('#start').val()),
				parseFloat($('#end').val()),
				parseFloat($('#rate').val()),
				function(time){
					$('#time').text(getTimeStr(time));
					if(((timer.rate < 0 && time <= 10000 && Math.abs(time - Math.round(time / 1000) * 1000) < 300) ||
						Math.abs(time - Math.round(time / 30000) * 30000) < 300
						)&& (new Date()).getTime() - lastCallAudioTime >= 900){

						lastCallAudioTime = (new Date()).getTime();
						$('#audio-time-0')[0].play();
						//lastCallAudioIndex = lastCallAudioIndex ? 0 : 1;
					}
				},
				function(){
					$('#audio-time-1')[0].play();
				}
			);
			restarted = false;
		}
		timer.run();
		$(this).hide();
		$('#pause').show();
		$('#audio-time-2')[0].play();
	});
	$('#pause').click(function(){
		timer.pause();
		$(this).hide();
		$('#run').show();
		$('#audio-time-1')[0].play();
	});
	$('#recover').click(function(){
		timer.recover();
		$('#time').text(getTimeStr(timer.startTime));
		$('#pause').hide();
		$('#run').show();
	});
</script>
</body>
</html>