var $jscomp={scope:{},findInternal:function(b,a,q){b instanceof String&&(b=String(b));for(var f=b.length,C=0;C<f;C++){var B=b[C];if(a.call(q,B,C,b))return{i:C,v:B}}return{i:-1,v:void 0}}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,a,q){if(q.get||q.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[a]=q.value)};
$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(b,a,q,f){if(a){q=$jscomp.global;b=b.split(".");for(f=0;f<b.length-1;f++){var C=b[f];C in q||(q[C]={});q=q[C]}b=b[b.length-1];f=q[b];a=a(f);a!=f&&null!=a&&$jscomp.defineProperty(q,b,{configurable:!0,writable:!0,value:a})}};
$jscomp.polyfill("Array.prototype.find",function(b){return b?b:function(a,b){return $jscomp.findInternal(this,a,b).v}},"es6-impl","es3");$jscomp.polyfill("Math.sign",function(b){return b?b:function(a){a=Number(a);return 0===a||isNaN(a)?a:0<a?1:-1}},"es6-impl","es3");
$jscomp.polyfill("Array.prototype.fill",function(b){return b?b:function(a,b,f){var q=this.length||0;0>b&&(b=Math.max(0,q+b));if(null==f||f>q)f=q;f=Number(f);0>f&&(f=Math.max(0,q+f));for(b=Number(b||0);b<f;b++)this[b]=a;return this}},"es6-impl","es3");var kUtil=kUtil||{};Math.sign||(Math.sign=function(b){return 0<b?1:0==b?0>1/b?-0:0:0>b?-1:NaN});kUtil.Matrix=function(b,a,q,f,C,B){this.a=b;this.b=a;this.c=q;this.d=f;this.e=C;this.f=B};
kUtil.Matrix.dot=function(b,a){return new kUtil.Matrix(b.a*a.a+b.c*a.b,b.b*a.a+b.d*a.b,b.a*a.c+b.c*a.d,b.b*a.c+b.d*a.d,b.a*a.e+b.c*a.f+b.e,b.b*a.e+b.d*a.f+b.f)};kUtil.Matrix.prototype.dot=function(b){return kUtil.Matrix.dot(this,b)};kUtil.Matrix.equals=function(b,a){return b.a==a.a&&b.b==a.b&&b.c==a.c&&b.d==a.d&&b.e==a.e&&b.f==a.f};kUtil.Matrix.prototype.equals=function(b){return kUtil.Matrix.equals(this,b)};
kUtil.Matrix.prototype.inversion=function(){var b=this.a,a=this.b,q=this.c,f=this.d,C=this.e,B=this.f,K=b*f-a*q;return new kUtil.Matrix(f/K,-a/K,-q/K,b/K,(q*B-f*C)/K,(a*C-b*B)/K)};kUtil.convertURLToBlob=function(b,a){var q=new XMLHttpRequest;q.open("GET",b,!0);q.responseType="blob";q.onloadend=function(){a(this.response)};q.send()};kUtil.convertBase64ToBlob=function(b,a){for(var q=atob(b),f=Array(q.length),C=0;C<q.length;++C)f[C]=q.charCodeAt(C);q=new Uint8Array(f);return new Blob([q],{type:a})};
Date.prototype.kUtilFormat=function(b){var a={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var q in a)(new RegExp("("+q+")")).test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?a[q]:("00"+a[q]).substr((""+a[q]).length)));return b};
kUtil.copyToClipBoard=function(b){if(navigator.clipboard)navigator.clipboard.writeText(b)["catch"](function(a){alert("copy failed, info: "+(a.message||a))});else{var a=document.createElement("textarea");a.style.width="4px";a.style.height="4px";a.style.position="fixed";a.style.left="0";a.style.top="0";$(document.body).append(a);a.value=b;a.focus();a.select();try{document.execCommand("copy")||alert("copy failed")}catch(q){alert("copy failed, info: "+(q.message||q))}$(a).remove()}};
(function(b){b.fn.borderWidth=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("border-left-width"):a.getAttribute("border-left-width"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("border-top-width"):a.getAttribute("border-top-width"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("border-right-width"):a.getAttribute("border-right-width"))||0;b.bottom=parseFloat(a.getPropertyValue?
a.getPropertyValue("border-bottom-width"):a.getAttribute("border-bottom-width"))||0;return b};b.fn.padding=function(){var a;a=window.getComputedStyle?getComputedStyle(this[0]):this[0].currentStyle;var b={};b.left=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-left"):a.getAttribute("padding-left"))||0;b.top=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-top"):a.getAttribute("padding-top"))||0;b.right=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-right"):a.getAttribute("padding-right"))||
0;b.bottom=parseFloat(a.getPropertyValue?a.getPropertyValue("padding-bottom"):a.getAttribute("padding-bottom"))||0;return b};b.fn.borderBoxRect=function(){var a=null;window.getComputedStyle&&(a=getComputedStyle(this[0]));var b=this.offset(),f={};f.pageX0=b.left;f.pageY0=b.top;f.width=a?parseFloat(a.width):this.outerWidth();f.height=a?parseFloat(a.height):this.outerHeight();f.pageX1=f.pageX0+f.width;f.pageY1=f.pageY0+f.height;return f};b.fn.paddingBoxRect=function(){var a=this.borderBoxRect(),b=this.borderWidth(),
f={};f.pageX0=a.pageX0+b.left;f.pageY0=a.pageY0+b.top;f.width=window.getComputedStyle?a.width-(b.left+b.right):this.innerWidth();f.height=window.getComputedStyle?a.height-(b.top+b.bottom):this.innerHeight();f.pageX1=a.pageX1-b.right;f.pageY1=a.pageY1-b.bottom;return f};b.fn.contentBoxRect=function(){var a=this.paddingBoxRect(),b=this.padding(),f={};f.pageX0=a.pageX0+b.left;f.pageY0=a.pageY0+b.top;f.width=window.getComputedStyle?a.width-(b.left+b.right):this.width();f.height=window.getComputedStyle?
a.height-(b.top+b.bottom):this.height();f.pageX1=a.pageX1-b.right;f.pageY1=a.pageY1-b.bottom;return f};b.fn.getTransform=function(){var a=this.css("transform");if("none"==a||""==a)a=this[0].style.transform;var b="matrix(",f=a.indexOf(b);if(-1!=f){f+=b.length;a=a.substring(f,a.indexOf(")",f)).split(",");for(b=0;b<a.length;++b)a[b]=parseFloat(a[b]);return new kUtil.Matrix(a[0],a[1],a[2],a[3],a[4],a[5])}b="scale(";f=a.indexOf(b);return-1!=f?(f+=b.length,a=parseFloat(a.substring(f)),new kUtil.Matrix(a,
0,0,a,0,0)):new kUtil.Matrix(1,0,0,1,0,0)};b.fn.setTransform=function(a){a="matrix("+[a.a,a.b,a.c,a.d,a.e,a.f].join()+")";this.css("transform",a)}})(jQuery);var TaskQueue=function(){this._queue=[];this.isWorking=!1;this.timeout=100};TaskQueue.prototype.push=function(b,a,q){this._queue.push({task:b,context:a,args:q});this.isWorking||this.next()};TaskQueue.prototype.unshift=function(b,a,q){this._queue.unshift({task:b,context:a,args:q});this.isWorking||this.next()};
TaskQueue.prototype.next=function(){if(0==this._queue.length)this.isWorking=!1;else{this.isWorking=!0;var b=this._queue.shift(),a=b.task,q=b.context?b.context:self,f=b.args?b.args:[];setTimeout(function(){a.apply(q,f)},this.timeout)}};
(function(){function b(a,b){b||a.match(/^data\:([^\;]+)\;base64,/mi);a=a.replace(/^data\:([^\;]+)\;base64,/gmi,"");for(var p=atob(a),c=p.length,r=new ArrayBuffer(c),f=new Uint8Array(r),u=0;u<c;u++)f[u]=p.charCodeAt(u);return r}function a(a,b){var p=new XMLHttpRequest;p.open("GET",a,!0);p.responseType="blob";p.onload=function(a){200!=this.status&&0!==this.status||b(this.response)};p.send()}function q(p,c){function r(a){var b=f(a),u;a:if(u=new DataView(a),255!=u.getUint8(0)||216!=u.getUint8(1))u=!1;
else{for(var z=2,r=a.byteLength;z<r;){var e=u,E=z;if(56===e.getUint8(E)&&66===e.getUint8(E+1)&&73===e.getUint8(E+2)&&77===e.getUint8(E+3)&&4===e.getUint8(E+4)&&4===e.getUint8(E+5)){e=u.getUint8(z+7);0!==e%2&&(e+=1);0===e&&(e=4);var r=z+8+e,z=u.getUint16(z+6+e),A,R;u=r;r=new DataView(a);e={};for(E=u;E<u+z;)28===r.getUint8(E)&&2===r.getUint8(E+1)&&(A=r.getUint8(E+2),A in V&&(R=r.getInt16(E+3),A=V[A],R=K(r,E+5,R),e.hasOwnProperty(A)?e[A]instanceof Array?e[A].push(R):e[A]=[e[A],R]:e[A]=R)),E++;u=e;break a}z++}u=
void 0}var q;a:if("DOMParser"in self)if(z=new DataView(a),255!=z.getUint8(0)||216!=z.getUint8(1))q=!1;else{r=2;e=a.byteLength;for(a=new DOMParser;r<e-4;)if("http"==K(z,r,4)){e=r-1;r=z.getUint16(r-2)-1;z=K(z,e,r);r=z.indexOf("xmpmeta>")+8;z=z.substring(z.indexOf("<x:xmpmeta"),r);r=z.indexOf("x:xmpmeta")+10;z=z.slice(0,r)+'xmlns:Iptc4xmpCore="http://iptc.org/std/Iptc4xmpCore/1.0/xmlns/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tiff="http://ns.adobe.com/tiff/1.0/" xmlns:plus="http://schemas.android.com/apk/lib/com.google.android.gms.plus" xmlns:ext="http://www.gettyimages.com/xsltExtension/1.0" xmlns:exif="http://ns.adobe.com/exif/1.0/" xmlns:stEvt="http://ns.adobe.com/xap/1.0/sType/ResourceEvent#" xmlns:stRef="http://ns.adobe.com/xap/1.0/sType/ResourceRef#" xmlns:crs="http://ns.adobe.com/camera-raw-settings/1.0/" xmlns:xapGImg="http://ns.adobe.com/xap/1.0/g/img/" xmlns:Iptc4xmpExt="http://iptc.org/std/Iptc4xmpExt/2008-02-29/" '+
z.slice(r);b:{a=a.parseFromString(z,"text/xml");try{z={};if(0<a.children.length)for(r=0;r<a.children.length;r++){var B=a.children.item(r),t=B.attributes,T;for(T in t){var y=t[T],v=y.nodeName,x=y.nodeValue;void 0!==v&&(z[v]=x)}var h=B.nodeName;if("undefined"==typeof z[h])z[h]=xml2json(B);else{if("undefined"==typeof z[h].push){var d=z[h];z[h]=[];z[h].push(d)}z[h].push(xml2json(B))}}else z=a.textContent;q=z;break b}catch(l){console.log(l.message)}q=void 0}break a}else r++;q=void 0}else q=void 0;p.exifdata=
b||{};p.iptcdata=u||{};p.xmpdata=q||{};c&&c.call(p)}if(p.src)if(/^data\:/i.test(p.src)){var e=b(p.src);r(e)}else if(/^blob\:/i.test(p.src)){var A=new FileReader;A.onload=function(a){r(a.target.result)};a(p.src,function(a){A.readAsArrayBuffer(a)})}else{var E=new XMLHttpRequest;E.onload=function(){if(200==this.status||0===this.status)r(E.response);else throw"Could not load image";E=null};E.open("GET",p.src,!0);E.responseType="arraybuffer";E.send(null)}else self.FileReader&&(p instanceof self.Blob||
p instanceof self.File)&&(A=new FileReader,A.onload=function(a){r(a.target.result)},A.readAsArrayBuffer(p))}function f(a){var b=new DataView(a);if(255!=b.getUint8(0)||216!=b.getUint8(1))return!1;var p=2;a=a.byteLength;for(var c;p<a;){if(255!=b.getUint8(p))return!1;c=b.getUint8(p+1);if(225==c)return w(b,p+4,b.getUint16(p+2)-2);p+=2+b.getUint16(p+2)}}function C(a,b,c,e,A){var p=a.getUint16(c,!A),u={},k,r,z;for(z=0;z<p;z++)k=c+12*z+2,r=e[a.getUint16(k,!A)],u[r]=B(a,k,b,c,A);return u}function B(a,b,c,
e,A){var p=a.getUint16(b+2,!A);e=a.getUint32(b+4,!A);c=a.getUint32(b+8,!A)+c;var u,k;switch(p){case 1:case 7:if(1==e)return a.getUint8(b+8,!A);c=4<e?c:b+8;b=[];for(p=0;p<e;p++)b[p]=a.getUint8(c+p);return b;case 2:return K(a,4<e?c:b+8,e-1);case 3:if(1==e)return a.getUint16(b+8,!A);c=2<e?c:b+8;b=[];for(p=0;p<e;p++)b[p]=a.getUint16(c+2*p,!A);return b;case 4:if(1==e)return a.getUint32(b+8,!A);b=[];for(p=0;p<e;p++)b[p]=a.getUint32(c+4*p,!A);return b;case 5:if(1==e)return u=a.getUint32(c,!A),k=a.getUint32(c+
4,!A),a=new Number(u/k),a.numerator=u,a.denominator=k,a;b=[];for(p=0;p<e;p++)u=a.getUint32(c+8*p,!A),k=a.getUint32(c+4+8*p,!A),b[p]=new Number(u/k),b[p].numerator=u,b[p].denominator=k;return b;case 9:if(1==e)return a.getInt32(b+8,!A);b=[];for(p=0;p<e;p++)b[p]=a.getInt32(c+4*p,!A);return b;case 10:if(1==e)return a.getInt32(c,!A)/a.getInt32(c+4,!A);b=[];for(p=0;p<e;p++)b[p]=a.getInt32(c+8*p,!A)/a.getInt32(c+4+8*p,!A);return b}}function K(a,b,c){for(var p="",e=b;e<b+c;e++)p+=String.fromCharCode(a.getUint8(e));
return p}function w(a,b){if("Exif"!=K(a,b,4))return!1;var c,p,f,r,u=b+6;if(18761==a.getUint16(u))c=!1;else if(19789==a.getUint16(u))c=!0;else return!1;if(42!=a.getUint16(u+2,!c))return!1;var k=a.getUint32(u+4,!c);if(8>k)return!1;p=C(a,u,u+k,e,c);if(p.ExifIFDPointer)for(f in r=C(a,u,u+p.ExifIFDPointer,t,c),r){switch(f){case "LightSource":case "Flash":case "MeteringMode":case "ExposureProgram":case "SensingMethod":case "SceneCaptureType":case "SceneType":case "CustomRendered":case "WhiteBalance":case "GainControl":case "Contrast":case "Saturation":case "Sharpness":case "SubjectDistanceRange":case "FileSource":r[f]=
D[f][r[f]];break;case "ExifVersion":case "FlashpixVersion":r[f]=String.fromCharCode(r[f][0],r[f][1],r[f][2],r[f][3]);break;case "ComponentsConfiguration":r[f]=D.Components[r[f][0]]+D.Components[r[f][1]]+D.Components[r[f][2]]+D.Components[r[f][3]]}p[f]=r[f]}if(p.GPSInfoIFDPointer)for(f in r=C(a,u,u+p.GPSInfoIFDPointer,F,c),r){switch(f){case "GPSVersionID":r[f]=r[f][0]+"."+r[f][1]+"."+r[f][2]+"."+r[f][3]}p[f]=r[f]}k=u+k;f=a.getUint16(k,!c);if(k=a.getUint32(k+2+12*f,!c))if(k>a.byteLength)u={};else{k=
C(a,u,u+k,y,c);if(k.Compression)switch(k.Compression){case 6:k.JpegIFOffset&&k.JpegIFByteCount&&(k.blob=new Blob([new Uint8Array(a.buffer,u+k.JpegIFOffset,k.JpegIFByteCount)],{type:"image/jpeg"}));break;case 1:console.log("Thumbnail image format is TIFF, which is not implemented.");break;default:console.log("Unknown thumbnail image format '%s'",k.Compression)}else 2==k.PhotometricInterpretation&&console.log("Thumbnail image format is RGB, which is not implemented.");u=k}else u={};p.thumbnail=u;return p}
var c=function(a){if(a instanceof c)return a;if(!(this instanceof c))return new c(a);this.EXIFwrapped=a};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=c),exports.EXIF=c):this.EXIF=c;var t=c.Tags={36864:"ExifVersion",40960:"FlashpixVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",37121:"ComponentsConfiguration",37122:"CompressedBitsPerPixel",37500:"MakerNote",37510:"UserComment",40964:"RelatedSoundFile",36867:"DateTimeOriginal",
36868:"DateTimeDigitized",37520:"SubsecTime",37521:"SubsecTimeOriginal",37522:"SubsecTimeDigitized",33434:"ExposureTime",33437:"FNumber",34850:"ExposureProgram",34852:"SpectralSensitivity",34855:"ISOSpeedRatings",34856:"OECF",37377:"ShutterSpeedValue",37378:"ApertureValue",37379:"BrightnessValue",37380:"ExposureBias",37381:"MaxApertureValue",37382:"SubjectDistance",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37396:"SubjectArea",37386:"FocalLength",41483:"FlashEnergy",41484:"SpatialFrequencyResponse",
41486:"FocalPlaneXResolution",41487:"FocalPlaneYResolution",41488:"FocalPlaneResolutionUnit",41492:"SubjectLocation",41493:"ExposureIndex",41495:"SensingMethod",41728:"FileSource",41729:"SceneType",41730:"CFAPattern",41985:"CustomRendered",41986:"ExposureMode",41987:"WhiteBalance",41988:"DigitalZoomRation",41989:"FocalLengthIn35mmFilm",41990:"SceneCaptureType",41991:"GainControl",41992:"Contrast",41993:"Saturation",41994:"Sharpness",41995:"DeviceSettingDescription",41996:"SubjectDistanceRange",40965:"InteroperabilityIFDPointer",
42016:"ImageUniqueID"},e=c.TiffTags={256:"ImageWidth",257:"ImageHeight",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer",40965:"InteroperabilityIFDPointer",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",274:"Orientation",277:"SamplesPerPixel",284:"PlanarConfiguration",530:"YCbCrSubSampling",531:"YCbCrPositioning",282:"XResolution",283:"YResolution",296:"ResolutionUnit",273:"StripOffsets",278:"RowsPerStrip",279:"StripByteCounts",513:"JPEGInterchangeFormat",514:"JPEGInterchangeFormatLength",
301:"TransferFunction",318:"WhitePoint",319:"PrimaryChromaticities",529:"YCbCrCoefficients",532:"ReferenceBlackWhite",306:"DateTime",270:"ImageDescription",271:"Make",272:"Model",305:"Software",315:"Artist",33432:"Copyright"},F=c.GPSTags={0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude",5:"GPSAltitudeRef",6:"GPSAltitude",7:"GPSTimeStamp",8:"GPSSatellites",9:"GPSStatus",10:"GPSMeasureMode",11:"GPSDOP",12:"GPSSpeedRef",13:"GPSSpeed",14:"GPSTrackRef",15:"GPSTrack",
16:"GPSImgDirectionRef",17:"GPSImgDirection",18:"GPSMapDatum",19:"GPSDestLatitudeRef",20:"GPSDestLatitude",21:"GPSDestLongitudeRef",22:"GPSDestLongitude",23:"GPSDestBearingRef",24:"GPSDestBearing",25:"GPSDestDistanceRef",26:"GPSDestDistance",27:"GPSProcessingMethod",28:"GPSAreaInformation",29:"GPSDateStamp",30:"GPSDifferential"},y=c.IFD1Tags={256:"ImageWidth",257:"ImageHeight",258:"BitsPerSample",259:"Compression",262:"PhotometricInterpretation",273:"StripOffsets",274:"Orientation",277:"SamplesPerPixel",
278:"RowsPerStrip",279:"StripByteCounts",282:"XResolution",283:"YResolution",284:"PlanarConfiguration",296:"ResolutionUnit",513:"JpegIFOffset",514:"JpegIFByteCount",529:"YCbCrCoefficients",530:"YCbCrSubSampling",531:"YCbCrPositioning",532:"ReferenceBlackWhite"},D=c.StringValues={ExposureProgram:{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"},MeteringMode:{0:"Unknown",1:"Average",
2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",
24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",
32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",
95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},SensingMethod:{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},SceneType:{1:"Directly photographed"},CustomRendered:{0:"Normal process",1:"Custom process"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},
GainControl:{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},SubjectDistanceRange:{0:"Unknown",1:"Macro",2:"Close view",3:"Distant view"},FileSource:{3:"DSC"},Components:{0:"",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}},V={120:"caption",110:"credit",25:"keywords",55:"dateCreated",80:"byline",85:"bylineTitle",122:"captionWriter",
105:"headline",116:"copyright",15:"category"};c.getData=function(a,b){if((self.Image&&a instanceof self.Image||self.HTMLImageElement&&a instanceof self.HTMLImageElement)&&!a.complete)return!1;a.exifdata?b&&b.call(a):q(a,b);return!0};c.getTag=function(a,b){if(a.exifdata)return a.exifdata[b]};c.getIptcTag=function(a,b){if(a.exifdata)return a.iptcdata[b]};c.getAllTags=function(a){if(!a.exifdata)return{};var b;a=a.exifdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};c.getAllIptcTags=
function(a){if(!a.exifdata)return{};var b;a=a.iptcdata;var c={};for(b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return c};c.pretty=function(a){if(!a.exifdata)return"";var b;a=a.exifdata;var c="";for(b in a)a.hasOwnProperty(b)&&(c="object"==typeof a[b]?a[b]instanceof Number?c+(b+" : "+a[b]+" ["+a[b].numerator+"/"+a[b].denominator+"]\r\n"):c+(b+" : ["+a[b].length+" values]\r\n"):c+(b+" : "+a[b]+"\r\n"));return c};c.readFromBinaryFile=function(a){return f(a)};"function"===typeof define&&define.amd&&define("exif-js",
[],function(){return c})}).call(this);
var KPainter=function(b){var a=this;b=b||{};KPainter.xxx="mouse"==b.gesturer?!1:"touch"==b.gesturer?!0:"ontouchend"in document?!0:!1;var q=function(a,b,c,e){a.toBlob?a.toBlob(b,c,e):(a=a.toDataURL(c,e),c=kUtil.convertBase64ToBlob(a.substring(a.indexOf(",")+1),c),b(c))},f=function(a,b,c){b=b||new kUtil.Matrix(1,0,0,1,0,0);var e=document.createElement("canvas"),k=!1;0!=b.a*b.d&&0==b.b*b.c?(e.width=a.naturalWidth||a.width,e.height=a.naturalHeight||a.height):(k=!0,e.width=a.naturalHeight||a.height,e.height=
a.naturalWidth||a.width);if(e.width>c||e.height>c)c/=Math.max(e.width,e.height),e.width=Math.min(e.width*c),e.height=Math.min(e.height*c);c=e.getContext("2d");c.setTransform(b.a,b.b,b.c,b.d,b.e*e.width,b.f*e.height);k?c.drawImage(a,0,0,e.height,e.width):c.drawImage(a,0,0,e.width,e.height);return e},C=function(a,b,c,e){var k=function(){var k=URL.createObjectURL(a),u=new Image;u.onload=u.onerror=function(){u.onload=u.onerror=null;var a=f(u,b,e);URL.revokeObjectURL(k);c(a)};u.src=k};window.createImageBitmap?
createImageBitmap(a).then(function(a){c(f(a,b,e))})["catch"](function(){k()}):k()},B=KPainter._doCallbackNoBreak,K=$('<div style="width:800px;height:600px;border:1px solid #ccc;"><div class="kPainterBox"><div class="kPainterImgsDiv"><canvas class="kPainterCanvas" style="display:none;left:0;top:0;"></canvas></div><div class="kPainterCroper" style="width:50px;height:50px;display:none;"><div class="kPainterCells"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div><div class="kPainterBigMover" data-orient="0,0" style="display:none"></div><div class="kPainterEdges"><div data-orient="-1,0"></div><div data-orient="0,-1"></div><div data-orient="1,0"></div><div data-orient="0,1"></div></div><div class="kPainterCorners"><div data-orient="-1,-1"><i></i></div><div data-orient="1,-1"><i></i></div><div data-orient="1,1"><i></i></div><div data-orient="-1,1"><i></i></div></div><div class="kPainterMover" data-orient="0,0"><div></div><svg width="20" height="20" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 896q0 26-19 45l-256 256q-19 19-45 19t-45-19-19-45v-128h-384v384h128q26 0 45 19t19 45-19 45l-256 256q-19 19-45 19t-45-19l-256-256q-19-19-19-45t19-45 45-19h128v-384h-384v128q0 26-19 45t-45 19-45-19l-256-256q-19-19-19-45t19-45l256-256q19-19 45-19t45 19 19 45v128h384v-384h-128q-26 0-45-19t-19-45 19-45l256-256q19-19 45-19t45 19l256 256q19 19 19 45t-19 45-45 19h-128v384h384v-128q0-26 19-45t45-19 45 19l256 256q19 19 19 45z" fill="#fff"/></svg></div></div><div class="kPainterPerspect" style="display:none;"><canvas class="kPainterPerspectCvs"></canvas><div class="kPainterPerspectCorner" data-index="0">lt</div><div class="kPainterPerspectCorner" data-index="1">rt</div><div class="kPainterPerspectCorner" data-index="2">rb</div><div class="kPainterPerspectCorner" data-index="3">lb</div></div><div class="kPainterGesturePanel"></div><div class="kPainterVideoMdl" style="display:none;"><video class="kPainterVideo" webkit-playsinline="true"></video><button class="kPainterBtnGrabVideo"><svg width="8vmin" viewBox="0 0 2048 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1024 672q119 0 203.5 84.5t84.5 203.5-84.5 203.5-203.5 84.5-203.5-84.5-84.5-203.5 84.5-203.5 203.5-84.5zm704-416q106 0 181 75t75 181v896q0 106-75 181t-181 75h-1408q-106 0-181-75t-75-181v-896q0-106 75-181t181-75h224l51-136q19-49 69.5-84.5t103.5-35.5h512q53 0 103.5 35.5t69.5 84.5l51 136h224zm-704 1152q185 0 316.5-131.5t131.5-316.5-131.5-316.5-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5z"/></svg></button><button class="kPainterBtnCloseVideo"><svg width="8vmin" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1490 1322q0 40-28 68l-136 136q-28 28-68 28t-68-28l-294-294-294 294q-28 28-68 28t-68-28l-136-136q-28-28-28-68t28-68l294-294-294-294q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294 294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68l-294 294 294 294q28 28 28 68z"/></svg></button></div></div></div>')[0],
w=$(K).children(),c=w.find("> .kPainterImgsDiv > .kPainterCanvas")[0];a.getHtmlElement=function(){return K};var t=-1,e=[],F=null,y=null,D=!1;a.getCurIndex=function(){return t};a.getCount=function(){return e.length};a.isEditing=function(){return D};a.getImage=function(a,b){void 0==b&&(b=t);if(!(isNaN(b)||(b=Math.round(b),0>b||b>=e.length))){var c;a?c=e[b]:(c=$(e[b]).clone()[0],c.setAttribute("style",""));return c}};a.onStartLoading=null;a.onFinishLoading=null;var V=function(){B(a.onStartLoading)},
p=function(){B(a.onFinishLoading)},r=new function(){var b=$('<input type="file" accept="image/bmp,image/gif,image/jpeg,image/png,image/webp" multiple style="display:none">');a.onAddImgFromFileChooseWindow=null;$(b).change(function(){for(var b=0;b<this.files.length-1;++b)r(this.files[b]);r(this.files[this.files.length-1],a.onAddImgFromFileChooseWindow);$(this).val("")});a.setHiddenFileIpt=function(a){return a instanceof HTMLInputElement?(b=a,!0):!1};a.showFileChooseWindow=function(){if(D)return null;
b.click();return b};a.onAddImgFromDropFile=null;w.on("drop",function(b){b=b.originalEvent;b.stopPropagation();b.preventDefault();b=b.dataTransfer.files;for(var d=0;d<b.length-1;++d)r(b[d]);r(b[b.length-1],a.onAddImgFromDropFile)});var c=new TaskQueue,r=a.addImageAsync=function(a,d){D?B(d,[!1]):a?a instanceof Blob||a instanceof HTMLCanvasElement||"string"==typeof a||a instanceof String||a instanceof HTMLImageElement?(V(),c.push(N,null,[a,function(a){B(d,[a]);c.next();c.isWorking||p()}])):B(d,[!1]):
B(d,[!1])},z=function(a,d){"image/jpeg"!=a.type?d(null):EXIF.getData(a,function(){var a=null;switch(EXIF.getTag(this,"Orientation")){case 6:a=new kUtil.Matrix(0,1,-1,0,1,0);break;case 3:a=new kUtil.Matrix(-1,0,0,-1,1,1);break;case 8:a=new kUtil.Matrix(0,-1,1,0,0,1)}d(a)})},A=function(a,d){var b=a.slice(25,26),g=new FileReader;g.onload=function(){var a=(new Int8Array(g.result))[0];d(4==(a&4))};g.readAsArrayBuffer(b)},y=function(a,d){var b=a.type;-1!=b.indexOf("webp")?d&&d("image/webp"):-1!=b.indexOf("gif")||
-1!=b.indexOf("svg")?d&&d("image/png"):-1!=b.indexOf("png")?A(a,function(a){d&&d(a?"image/png":"image/jpeg")}):d&&d("image/jpeg")},N=function(a,d){F(a,function(a,b){a?B(function(){E(a,b,d)}):d(!1)})},F=this.getBlobAndFormatFromAnyImgData=function(a,d){var b=function(a){y(a,function(b){z(a,function(g){X(a,g,b,function(a){d(a,b)})})})};if(a instanceof Blob)b(a);else if(a instanceof HTMLCanvasElement)q(a,function(a){b(a)});else if("string"==typeof a||a instanceof String)if("data:"==a.substring(0,5)){var g=
"";"image/"==a.substring(5,11)&&(g=a.substring(5,a.indexOf(";",11)));g=kUtil.convertBase64ToBlob(a.substring(a.indexOf("base64,")+7),g);b(g)}else kUtil.convertURLToBlob(a,function(a){a?b(a):d(null,"")});else if(a instanceof HTMLImageElement){var h;try{h=a.src}catch(n){setTimeout(function(){throw n;},0);d(null,"");return}F(h,function(g,l){if(g)d(g,l);else{var c=document.createElement("canvas");c.width=a.naturalWidth;c.height=a.naturalHeight;c.getContext("2d").drawImage(a,0,0);var n="",m=h.lastIndexOf("?"),
e=-1;-1!=m?(e=h.lastIndexOf(".",m),-1!=e&&5>=m-e&&(n=h.substring(e+1,m))):(e=h.lastIndexOf("."),-1!=e&&(n=5>=h.length-e?h.substring(e+1):h.substring(e+1,e+5)));n=-1!=n.indexOf("webp")?"image/webp":-1!=n.indexOf("png")||-1!=n.indexOf("gif")||-1!=n.indexOf("svg")?"image/png":"image/jpeg";q(c,function(a){b(a)},n)}})}else d(null,"")};a.addedImageMaxWH=4096;var X=function(a,d,b,g){d?C(a,d,function(a){q(a,function(a){g&&g(a)},b)}):g&&g(a)};a.isShowNewImgWhenAdd=!0;var E=function(b,d,l){var g=new Image;
g.kPainterOriBlob=g.kPainterBlob=b;g.kPainterSaveFormat=d;var h=URL.createObjectURL(g.kPainterBlob);g.onload=g.onerror=function(){a._noAnyUseButForIosSafariBug0=g.naturalWidth;a._noAnyUseButForIosSafariBug1=g.naturalHeight;g.kPainterWidth=g.naturalWidth;g.kPainterHeight=g.naturalHeight;g.kPainterOriWidth=g.kPainterWidth;g.kPainterOriHeight=g.kPainterHeight;if(g.kPainterWidth>a.addedImageMaxWH||g.kPainterHeight>a.addedImageMaxWH)q(f(g,null,a.addedImageMaxWH),function(a){URL.revokeObjectURL(h);g.kPainterOriBlob=
g.kPainterBlob=a;h=URL.createObjectURL(g.kPainterBlob);g.src=h},d);else{g.onload=g.onerror=null;(a.isShowNewImgWhenAdd||-1==t)&&G(e.length-1);try{(function(){for(var a=0;a<n.length;++a){var d=n[a].cvs,b=n[a].mwh,b=Math.min(b/g.naturalWidth,b/g.naturalHeight,1);d.width=Math.round(g.naturalWidth*b);d.height=Math.round(g.naturalHeight*b);d.getContext("2d").drawImage(g,0,0,d.width,d.height)}})()}catch(I){setTimeout(function(){throw I;},0)}l&&l(!0)}};g.src=h;$(g).hide();w.children(".kPainterImgsDiv").append(g);
e.push(g);var n=[];try{(function(){for(var a=0;a<x.length;++a){var d=x[a],b=d.kPainterFunWrap,g=document.createElement("canvas");g.className="kPainterThumbnailCanvas";n.push({cvs:g,mwh:d.kPainterMaxWH});var h=null;try{h=b?b(g):g}catch(S){setTimeout(function(){throw S;},0);break}h&&(h.getKPainterIndex=function(){return d.kPainterThumbBoxArr.indexOf(this)},d.kPainterThumbBoxArr.push(h),d.appendChild(h))}})()}catch(I){setTimeout(function(){throw I;},0)}},P=function(){var a=e[t],d=w;d.paddingBoxRect();
var d=d.contentBoxRect(),b=a.kPainterZoom=Math.min(d.width/a.kPainterWidth,d.height/a.kPainterHeight);a.style.width=(Math.round(a.kPainterWidth*b)||1)+"px";a.style.height=(Math.round(a.kPainterHeight*b)||1)+"px";a.style.left=a.style.right=a.style.top=a.style.bottom="-100000px";if(2<=e.length){var g=e[(e.length+t-1)%e.length],b=Math.min(d.width/g.kPainterWidth,d.height/g.kPainterHeight);g.style.width=(Math.round(g.kPainterWidth*b)||1)+"px";g.style.height=(Math.round(g.kPainterHeight*b)||1)+"px";g.style.right=
"100000px";g.style.left=g.style.top=g.style.bottom="-100000px"}3<=e.length&&(a=e[(e.length+t+1)%e.length],b=Math.min(d.width/a.kPainterWidth,d.height/a.kPainterHeight),a.style.width=(Math.round(a.kPainterWidth*b)||1)+"px",a.style.height=(Math.round(a.kPainterHeight*b)||1)+"px",a.style.left="100000px",a.style.right=a.style.top=g.style.bottom="-100000px")},M=null,H;a.updateUIOnResize=function(a,d){null!=M&&(clearTimeout(M),M=null);a?(H=D,M=setTimeout(function(){-1!=t&&H==D&&(D?R.setImgStyleFit():P(),
B(d));M=null},500)):-1!=t&&(D?R.setImgStyleFit():P(),B(d))};var G=this.showImg=function(b){var d=e[b];$(d).siblings().hide();t=b;$(d).show();2<=e.length&&(0<b||a.allowedTouchMoveSwitchImgOverBoundary)&&$(e[(e.length+b-1)%e.length]).show();3<=e.length&&(b<e.length-1||a.allowedTouchMoveSwitchImgOverBoundary)&&$(e[(e.length+b+1)%e.length]).show();P();v()};a.onNumChange=null;var v=function(){var b=void 0,d=void 0;return function(){if(b!=t||d!=e.length)b=t,d=e.length,B(a.onNumChange,[t,e.length])}}();
a.changePage=function(a){if(D)return!1;var b;switch(a){case "f":b=0;break;case "p":b=t-1;break;case "n":b=t+1;break;case "l":b=e.length-1;break;default:if(1>arguments.length||isNaN(a))return!1;b=Math.round(a)}if(0>b||b>=e.length||b==t)return!1;G(b);return!0};a.del=function(a){if(D)return!1;1>arguments.length&&(a=t);if(isNaN(a))return!1;a=Math.round(a);if(0>a||a>=e.length)return!1;URL.revokeObjectURL(e[a].src);$(e[a]).remove();e.splice(a,1);try{for(var b=0;b<x.length;++b){var c=x[b];$(c.kPainterThumbBoxArr[a]).remove();
c.kPainterThumbBoxArr.splice(a,1)}}catch(g){setTimeout(function(){throw g;},0)}a<t?(--t,v()):a==t?(t==e.length&&--t,0<=t?G(t):v()):v();return!0};a.getWidth=function(a){1>arguments.length&&(a=t);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=e.length?NaN:e[a].kPainterWidth};a.getHeight=function(a){1>arguments.length&&(a=t);if(isNaN(a))return NaN;a=Math.round(a);return 0>a||a>=e.length?NaN:e[a].kPainterHeight};a.getBlob=function(a){1>arguments.length&&(a=t);if(isNaN(a))return null;a=Math.round(a);
return 0>a||a>=e.length?null:e[a].kPainterBlob};a.download=function(a,b){2>arguments.length&&(b=t);if(isNaN(b))return null;b=Math.round(b);if(0>b||b>=e.length)return null;var d=document.createElement("a");d.target="_blank";var g=e[b].kPainterBlob;if(!a){var c="";g.type&&(c=g.type.substring(g.type.indexOf("/")+1));c="jpeg"==c?".jpg":"."+c;a=(new Date).getTime()+c}d.download=a;var n=URL.createObjectURL(g);d.href=n;g=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!1});d.dispatchEvent(g);setTimeout(function(){URL.revokeObjectURL(n)},
1E4);return a};var x=this.thumbnailBoxArr=[];a.bindThumbnailBox=function(b,d,c){if(D||!(b instanceof HTMLDivElement))return!1;a.unbindThumbnailBox(b);b.innerHTML="";b.kPainterFunWrap=d;b.kPainterMaxWH=c||100;b.kPainterThumbBoxArr=[];for(c=0;c<e.length;++c){var g=e[c];a._noAnyUseButForIosSafariBug0=g.naturalWidth;a._noAnyUseButForIosSafariBug1=g.naturalHeight;var l=Math.min(b.kPainterMaxWH/g.naturalWidth,b.kPainterMaxWH/g.naturalHeight,1),n=document.createElement("canvas");n.width=Math.round(g.naturalWidth*
l);n.height=Math.round(g.naturalHeight*l);n.getContext("2d").drawImage(g,0,0,n.width,n.height);n.className="kPainterThumbnailCanvas";g=null;try{g=d?d(n):n}catch(I){return setTimeout(function(){throw I;},0),!1}g&&(g.getKPainterIndex=function(){return b.kPainterThumbBoxArr.indexOf(this)},b.kPainterThumbBoxArr.push(g),b.appendChild(g))}x.push(b);return!0};a.unbindThumbnailBox=function(a){if(D)return!1;if(a){for(var b=0;b<x.length;++b)if(x[b]==a)return a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=
void 0,x.splice(b,1),!0;return!1}for(b=0;b<x.length;++b)a=x[b],a.innerHTML="",a.kPainterFunWrap=void 0,a.kPainterThumbBoxArr=void 0;x.length=0;return!0}};(function(a){a=a.length?a[0]:function(a){var b=a.indexOf(".");return 3!=b?a.substring(b,b+32):a.substring(0,8)}(location.host);for(var b=1,c=0;c<a.length;++c)b*=a.charCodeAt(c),b+=a.charCodeAt((c+1)%a.length),b%=11003;5095!=b&&3124!=b&&8633!=b&&3122!=b&&setTimeout(function(){B=function(){}},1E5*(1+2*Math.random()))})(arguments);var R=new function(){var b=
Number.NEGATIVE_INFINITY,k;a.leftDoubleClickZoomRate=2;a.rightDoubleClickZoomRate=.5;var f,p,q,C,N,L,E,U,P,M,H,G,v,x,h,d,l,g,m,n,I,J;a.allowedTouchMoveSwitchImgOverBoundary=!0;var Q=function(){if(-1!=t&&"posZoom"==F){F=y=null;w.find("> .kPainterCroper > .kPainterEdges").children().css("z-index",1);w.find("> .kPainterCroper > .kPainterCorners").children().css("z-index",1);w.find("> .kPainterCroper > .kPainterMover").css("z-index",1);w.find("> .kPainterCroper > .kPainterBigMover").css("z-index",1);
if(!D&&1!=e.length){var c=!1,l,m;1.2>n/I&&(c=!0,l=Math.sqrt(Math.pow(N-f,2)+Math.pow(L-p,2)),m=l/(((new Date).getTime()-b)/1E3));if(g<-(Math.round(d*n)||1)/2||c&&-50>l&&-200>m){if(t+1<e.length||a.allowedTouchMoveSwitchImgOverBoundary){r.showImg((e.length+t+1)%e.length);return}}else if(g>(Math.round(d*n)||1)/2||c&&50<l&&200<m)if(0<=t-1||a.allowedTouchMoveSwitchImgOverBoundary){r.showImg((e.length+t-1)%e.length);return}}S();W()}},O=function(a){var b=w;D?(x=c,d=x.width,l=x.height):(x=e[t],d=x.kPainterWidth,
l=x.kPainterHeight);g=parseFloat(x.style.left)+1E5;m=parseFloat(x.style.top)+1E5;h=$(x).getTransform();if(0==h.a*h.d||0!=h.b*h.c){var Z=d;d=l;l=Z}n=x.kPainterZoom||1;G=b.paddingBoxRect();v=b.contentBoxRect();I=Math.min(v.width/d,v.height/l);D&&A.isCropRectShowing&&!a&&(a=A.getNeededRect(),I=Math.max(Math.max(a.width,d*I)/d,Math.max(a.height,l*I)/l))};a.onUpdateImgPosZoom=null;var W=function(){x.style.left=g-1E5+"px";x.style.right=-g-1E5+"px";x.style.top=m-1E5+"px";x.style.bottom=-m-1E5+"px";x.kPainterZoom=
n;0!=h.a*h.d&&0==h.b*h.c?(x.style.width=(Math.round(d*n)||1)+"px",x.style.height=(Math.round(l*n)||1)+"px"):(x.style.height=(Math.round(d*n)||1)+"px",x.style.width=(Math.round(l*n)||1)+"px");if(!D&&1!=e.length){var b=Math.max(0,((Math.round(d*n)||1)-G.width)/2);if(2<e.length||g>b){var c=e[(e.length+t-1)%e.length];c.style.left=g-b-G.width+"px";c.style.right=-g+b+G.width+"px"}if(2<e.length||g<=-b)c=e[(e.length+t+1)%e.length],c.style.left=g+b+G.width+"px",c.style.right=-g-b-G.width+"px"}B(a.onUpdateImgPosZoom)},
S=function(a,b){4<n&&(n=4);n<I&&(n=I);if(!a){var c=Math.round(d*n)||1;v.width>c?g=0:(c=(c-v.width)/2,g<-c?g=-c:g>c&&(g=c))}b||(c=Math.round(l*n)||1,v.height>c?m=0:(c=(c-v.height)/2,m<-c?m=-c:m>c&&(m=c)))};a.getZoom=function(){if(0!=e.length)return O(),n};a.setZoom=function(a,b){if(0!=e.length&&(a=parseFloat(a),a===a))return n=b?n*a:a,S(),W(),n};this.setImgStyleFit=function(){O(!0);n=I;S();W();a.setCropRectArea()};w.on("touchstart touchcancel touchend mousedown",function(d){d.preventDefault();if(-1!=
t){var c=d.originalEvent;d=c.targetTouches;var l;if(!d){if(!y)y="mouse";else if("mouse"!=y)return;d=[{pageX:c.clientX,pageY:c.clientY}];l=c.buttons}else if(d.length)if(!y)y="touch";else if("touch"!=y)return;if(1==d.length){N=f=d[0].pageX;L=p=d[0].pageY;O();c=b;b=(new Date).getTime();var e=k;k=l||(.01>Math.abs(n-I)/I?1:2);if(1E3>b-c&&k==e&&(1==k||2==k)&&8>Math.abs(d[0].pageX-q)&&8>Math.abs(d[0].pageY-C)){b=Number.NEGATIVE_INFINITY;l=N;var c=L,v=n,e=1==k?a.leftDoubleClickZoomRate:a.rightDoubleClickZoomRate;
n*=e;4<n&&(n=4,e=4/v);n<I&&(n=I,e=I/v);v=m+G.pageY0+G.height/2;g-=(e-1)*(l-(g+G.pageX0+G.width/2));m-=(e-1)*(c-v);S()}null==F&&(F="posZoom",w.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),w.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),w.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),w.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),J=d[0].identifier)}else 2==d.length?(N=f=d[0].pageX,L=p=d[0].pageY,
null==F&&(F="posZoom"),"posZoom"==F&&(O(),w.find("> .kPainterCroper > .kPainterEdges").children().css("z-index","unset"),w.find("> .kPainterCroper > .kPainterCorners").children().css("z-index","unset"),w.find("> .kPainterCroper > .kPainterMover").css("z-index","unset"),w.find("> .kPainterCroper > .kPainterBigMover").css("z-index","unset"),P=d[1].pageX,M=d[1].pageY,E=(N+P)/2,U=(L+M)/2,H=Math.sqrt(Math.pow(N-P,2)+Math.pow(L-M,2)))):0==d.length&&(q=N,C=L,Q())}});w.on("mouseup",function(a){"mouse"==y&&
(a=a.originalEvent,q=a.clientX,C=a.clientY,Q())});w.on("mouseleave",function(a){"mouse"==y&&a.originalEvent.buttons&&(q=N,C=L,Q())});w.on("contextmenu",function(a){a.preventDefault()});w.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=y)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if("touch"!=y)return;if(1==b.length){if("posZoom"==F&&J==b[0].identifier){a=N;var d=L;N=b[0].pageX;L=b[0].pageY;g+=N-a;m+=L-
d;S(!D);W()}}else if(2==b.length&&"posZoom"==F){a=E;var d=U,c=H,l=n;N=b[0].pageX;L=b[0].pageY;P=b[1].pageX;M=b[1].pageY;E=(N+P)/2;U=(L+M)/2;H=Math.sqrt(Math.pow(N-P,2)+Math.pow(L-M,2));b=H/c;n*=b;4<n&&(n=4,b=4/l);n<I&&(n=I,b=I/l);l=m+G.pageY0+G.height/2;g-=(b-1)*(a-(g+G.pageX0+G.width/2));m-=(b-1)*(d-l);S();W()}})},T=new function(){var b=this,k,f=[];a.stepImgsGCThreshold=10;var z=[],C=[];a.addProtectedStep=function(a){a=parseInt(a);a===a&&-1==C.indexOf(a)&&(C.push(a),C.sort(function(a,b){return a-
b}))};a.removeProtectedStep=function(a){a=parseInt(a);a===a&&(a=C.indexOf(a),-1!=a&&C.splice(a,1))};a.getProtectedSteps=function(){return C.concat()};var Y=b.pushStack=function(b){f.length=k+1;for(var c=z.length-1;0<c;--c)if(z[c].beginStep>k)--z.length;else break;var v;if(b.srcBlob){v={crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:b.srcBlob,saveFormat:b.saveFormat};for(c=0;z.length>=a.stepImgsGCThreshold;)if(C.filter(function(a){return z[c].beginStep<=a&&a<z[c].endStep}).length){if(!(++c<
z.length))break}else{b=z[c].endStep;for(var d=z[c].beginStep;d<b;++d)f[d]=null;z.splice(c,1)}f.push(v);++k;z.push({blob:v.srcBlob,beginStep:k,endStep:k+1})}else{v=f[k];var l=v.crop,g=b.transform,m=b.crop,d={};b=g?g:v.transform;d.left=l.left;d.top=l.top;d.width=l.width;d.height=l.height;0!=b.a*b.d&&0==b.b*b.c?(g&&(b=new kUtil.Matrix(Math.sign(g.a),0,0,Math.sign(g.d),0,0)),m&&(d.left=1==b.a?d.left+m.left*l.width:d.left+(1-m.left-m.width)*l.width,d.top=1==b.d?d.top+m.top*l.height:d.top+(1-m.top-m.height)*
l.height,d.width*=m.width,d.height*=m.height)):(g&&(b=new kUtil.Matrix(0,Math.sign(g.b),Math.sign(g.c),0,0,0)),m&&(d.left=1==b.b?d.left+m.top*l.width:d.left+(1-m.top-m.height)*l.width,d.top=1==b.c?d.top+m.left*l.height:d.top+(1-m.left-m.width)*l.height,d.width*=m.height,d.height*=m.width));l=e[t];l=Math.pow(10,Math.ceil(Math.max(l.kPainterWidth,l.kPainterHeight)).toString().length+2);d.left=Math.round(d.left*l)/l;d.top=Math.round(d.top*l)/l;d.width=Math.round(d.width*l)/l;d.height=Math.round(d.height*
l)/l;v={crop:d,transform:b,srcBlob:v.srcBlob,saveFormat:v.saveFormat};f.push(v);++k;v.srcBlob&&(z[z.length-1].endStep=k+1)}};a.undo=function(a){if(!D)B(a,[!1]);else if(0<k){for(var b=k-1;null==f[b];)--b;N(k,b,function(){B(a,[!0])})}};a.redo=function(a){if(!D)B(a,[!1]);else if(k<f.length-1){for(var b=k+1;null==f[b];)++b;N(k,b,function(){B(a,[!0])})}};a.getStepCount=function(){return f.length};a.getCurStep=function(){return k};a.setCurStepAsync=function(a,b){1>arguments.length||isNaN(a)?B(b,[!1]):(a=
Math.round(a),0>a||a>=f.length||null==f[a]?B(b,[!1]):N(k,a,function(){B(b,[!0])}))};b.needAlwaysTrueTransform=!1;var N=function(a,e,h){k=e;e=f[a].crop;var d=f[k].crop;e.left==d.left&&e.top==d.top&&e.width==d.width&&e.bottom==d.bottom&&f[a].srcBlob==f[k].srcBlob?($(c).setTransform(f[k].transform.dot(f[a].transform.inversion()).dot($(c).getTransform())),R.setImgStyleFit(),h&&h()):U(b.needAlwaysTrueTransform,!1,h)},L=function(b){$(c).siblings().hide();U(!1,!1,function(){a.isAutoShowCropUI&&A.showCropRect();
b&&b()})},X;X=Math.min(screen.width,screen.height)*(window.devicePixelRatio||1);var U=b.updateCvsAsync=function(a,b,h){$(c).hide();var d=f[k],l=d.srcBlob||e[t].kPainterOriBlob,g=function(){var c=URL.createObjectURL(l),g=new Image;g.onload=g.onerror=function(){g.onload=g.onerror=null;P(g,d,a,b);URL.revokeObjectURL(c);h&&h()};g.src=c};window.createImageBitmap?createImageBitmap(l).then(function(c){P(c,d,a,b);h&&h()})["catch"](function(){g()}):g()},P=function(b,e,f,d){a._noAnyUseButForIosSafariBug0=b.naturalWidth;
a._noAnyUseButForIosSafariBug1=b.naturalHeight;var l=b.naturalWidth||b.width,g=b.naturalHeight||b.height,m=e.crop;e=e.transform;var n=c.getContext("2d"),k=c.fullQualityWidth=Math.round(l*m.width)||1,J=c.fullQualityHeight=Math.round(g*m.height)||1,Q=!1;0!=e.a*e.d&&0==e.b*e.c?(c.fullQualityWidth=k,c.fullQualityHeight=J):(c.fullQualityWidth=J,c.fullQualityHeight=k,f&&(Q=!0));c.hasCompressed=!1;if(f){var O,h;Q?(O=J,h=k):(O=k,h=J);c.width=O;c.height=h;n.setTransform(e.a,e.b,e.c,e.d,O/2*(1-e.a-e.c),h/2*
(1-e.b-e.d))}else k>X||J>X?(O=X/Math.max(k,J),c.width=Math.round(k*O)||1,c.height=Math.round(J*O)||1,c.hasCompressed=!0):(c.width=k,c.height=J);O=Math.round(l*m.left);m=Math.round(g*m.top);O==l&&--O;m==g&&--m;Q?(l=c.height,g=c.width):(l=c.width,g=c.height);if(2>=k/l)n.drawImage(b,O,m,k,J,0,0,l,g);else{Q=document.createElement("canvas");Q.width=Math.round(k/2);Q.height=Math.round(J/2);h=Q.getContext("2d");var S=Math.round(k/2),v=Math.round(J/2);for(h.drawImage(b,O,m,k,J,0,0,S,v);;){b=S;k=v;S=Math.round(b/
2);v=Math.round(k/2);if(S<=l||v<=g)break;h.drawImage(Q,0,0,b,k,0,0,S,v)}n.drawImage(Q,0,0,b,k,0,0,l,g)}f?$(c).setTransform(new kUtil.Matrix(1,0,0,1,0,0)):$(c).setTransform(e);d||(R.setImgStyleFit(),$(c).show())};a.enterEditAsync=function(a){if(D||-1==t)B(a,[!1]);else{V();D=!0;var b=e[t].kPainterProcess||{crop:{left:0,top:0,width:1,height:1},transform:new kUtil.Matrix(1,0,0,1,0,0),srcBlob:null,saveFormat:null};f.push(b);k=0;L(function(){p();F=y=null;B(a,[!0])})}};var M=a.cancelEdit=function(){if(!D)return!1;
D=!1;f.length=0;z.length=0;r.showImg(t);$(c).hide();A.hideCropRect();E.hideFreeTransformBorderDirectly();F=y=null;return!0},H=function(a,b){var h=f[k].crop,d=f[k].transform,l=f[0].crop,g=f[0].transform,m=e[t];if(f[k].srcBlob||g.a!=d.a||g.b!=d.b||g.c!=d.c||g.d!=d.d||Math.round(m.kPainterOriWidth*h.left)!=Math.round(m.kPainterOriWidth*l.left)||Math.round(m.kPainterOriHeight*h.top)!=Math.round(m.kPainterOriHeight*l.top)||Math.round(m.kPainterOriWidth*(h.left+h.width))!=Math.round(m.kPainterOriWidth*
(l.left+l.width))||Math.round(m.kPainterOriHeight*(h.top+h.height))!=Math.round(m.kPainterOriHeight*(l.top+l.height))){URL.revokeObjectURL(m.src);var n=new Image,h=function(){n.onload=n.onerror=function(){n.onload=n.onerror=null;b?($(e[t]).remove(),e.splice(t,1,n)):e.splice(++t,0,n);w.children(".kPainterImgsDiv").append(n);a&&a()};q(c,function(a){n.kPainterBlob=a;n.kPainterWidth=c.width;n.kPainterHeight=c.height;f[k].srcBlob?(n.kPainterOriBlob=a,n.kPainterOriWidth=c.width,n.kPainterOriHeight=c.height,
n.kPainterSaveFormat=f[k].saveFormat):(n.kPainterOriBlob=m.kPainterOriBlob,n.kPainterOriWidth=m.kPainterOriWidth,n.kPainterOriHeight=m.kPainterOriHeight,n.kPainterProcess=f[k],n.kPainterSaveFormat=m.kPainterSaveFormat);a=URL.createObjectURL(a);n.src=a},f[k].saveFormat||m.kPainterSaveFormat)};c.hasCompressed||1!=d.a||0!=d.b||0!=d.c||1!=d.d||0!=d.e||0!=d.f?($(c).hide(),U(!0,!0,h)):h()}else a()},G=!1;a.saveEditAsync=function(b,c){!D||G?B(b,[!1]):(G=!0,V(),setTimeout(function(){H(function(){M();p();G=
!1;F=y=null;try{(function(){for(var b=0;b<r.thumbnailBoxArr.length;++b){var d=r.thumbnailBoxArr[b],l=e[t];a._noAnyUseButForIosSafariBug0=l.naturalWidth;a._noAnyUseButForIosSafariBug1=l.naturalHeight;var g=Math.min(d.kPainterMaxWH/l.naturalWidth,d.kPainterMaxWH/l.naturalHeight,1),m;c?(m=$(d.kPainterThumbBoxArr[t]),m=m.hasClass("kPainterThumbnailCanvas")?m[0]:m.children(".kPainterThumbnailCanvas")):(m=document.createElement("canvas"),m.className="kPainterThumbnailCanvas");m.width=Math.round(l.naturalWidth*
g);m.height=Math.round(l.naturalHeight*g);m.getContext("2d").drawImage(l,0,0,m.width,m.height);if(!c){l=d.kPainterFunWrap;g=null;try{g=l?l(m):m}catch(n){return setTimeout(function(){throw n;},0),!1}g&&(g.getKPainterIndex=function(){return d.kPainterThumbBoxArr.indexOf(this)},d.kPainterThumbBoxArr.splice(t,0,g),$(d.kPainterThumbBoxArr[t-1]).after(g))}}})()}catch(h){setTimeout(function(){throw h;},0)}B(b,[!0])},c)},100))};a.rotateRight=function(){if(!D)return!1;var a=$(c).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,
1,-1,0,0,0),a);$(c).setTransform(a);Y({transform:a});a=c.fullQualityWidth;c.fullQualityWidth=c.fullQualityHidth;c.fullQualityHeight=a;R.setImgStyleFit();return!0};a.rotateLeft=function(){if(!D)return!1;var a=$(c).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(0,-1,1,0,0,0),a);$(c).setTransform(a);Y({transform:a});a=c.fullQualityWidth;c.fullQualityWidth=c.fullQualityHidth;c.fullQualityHeight=a;R.setImgStyleFit();return!0};a.mirror=function(){if(!D)return!1;var a=$(c).getTransform(),a=kUtil.Matrix.dot(new kUtil.Matrix(-1,
0,0,1,0,0),a);$(c).setTransform(a);Y({transform:a});R.setImgStyleFit();return!0};a.resizeAsync=function(a,e,f){if(!D)return B(f,[!1]);a=parseInt(a);e=parseInt(e);if(a!==a||1>a||e!==e||1>e)return B(f,[!1]);V();b.updateCvsAsync(!0,!0,function(){b.needAlwaysTrueTransform=!0;for(var d=a,l=e;2*d<c.width;)d*=2;for(;2*l<c.height;)l*=2;for(var g=c,m;;){m=document.createElement("canvas");m.width=d;m.height=l;m.getContext("2d").drawImage(g,0,0,d,l);var n=!1;a!=d&&(d/=2,n=!0);e!=l&&(l/=2,n=!0);if(!n)break}q(m,
function(a){b.pushStack({srcBlob:a,saveFormat:"image/jpeg"});b.updateCvsAsync(!1,!1,function(){b.needAlwaysTrueTransform=!1;p();B(f,[!0])})})})};a.getEditWidth=function(){return D?c.fullQualityWidth:NaN};a.getEditHeight=function(){return D?c.fullQualityHeight:NaN}},A=new function(){var b=this;a.isAutoShowCropUI=!0;var e=w.children(".kPainterCroper");b.isCropRectShowing=!1;a.showCropRect=b.showCropRect=function(){D&&(b.isCropRectShowing=!0,O(),e.show())};a.hideCropRect=b.hideCropRect=function(){b.isCropRectShowing=
!1;e.hide()};e.css({"border-left-width":"100000px","border-top-width":"100000px","border-right-width":"100000px","border-bottom-width":"100000px",left:"-100000px",top:"-100000px",right:"-100000px",bottom:"-100000px"});a.setCropRectStyle=function(a){switch(a){case 0:return e.find(">.kPainterBigMover").hide(),e.find(">.kPainterMover").show(),!0;case 1:return e.find(">.kPainterMover").hide(),e.find(">.kPainterBigMover").show(),!0;default:return!1}};var f,p,q,r,t,A,C,E,P,M,H,G,v,x,h,d,l,g,m,n;a.cropRectMinW=
50;a.cropRectMinH=50;var I=function(){"crop"==F&&(F=y=null)},J=function(){A=w.contentBoxRect();var a=$(c).getTransform(),b=parseFloat(c.style.left)+1E5,f=parseFloat(c.style.top)+1E5;0!=a.a*a.d&&0==a.b*a.c?(H=parseFloat(c.style.width),G=parseFloat(c.style.height)):(H=parseFloat(c.style.height),G=parseFloat(c.style.width));var a=H/2,J=G/2;C=b-a;E=f-J;P=b+a;M=f+J;h=parseFloat(e[0].style.width);d=parseFloat(e[0].style.height);v=parseFloat(e[0].style.left)-h/2+1E5;x=parseFloat(e[0].style.top)-d/2+1E5;
l=Math.max(-A.width/2,C);g=Math.max(-A.height/2,E);m=Math.min(A.width/2,P);n=Math.min(A.height/2,M)};w.find("> .kPainterCroper > .kPainterEdges > div, > .kPainterCroper > .kPainterCorners > div, > .kPainterCroper > .kPainterMover, > .kPainterCroper > .kPainterBigMover").on("touchstart touchcancel touchend mousedown",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if(!y)y="mouse";else if("mouse"!=y)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!y)y=
"touch";else if("touch"!=y)return;1==b.length?null==F&&(F="crop",q=b[0].identifier,f=b[0].pageX,p=b[0].pageY,a=$(this).attr("data-orient").split(","),r=a[0],t=a[1],J()):0==b.length&&I()});w.on("mouseup",function(){"mouse"==y&&I()});w.on("mouseleave",function(a){"mouse"==y&&a.originalEvent.buttons&&I()});a.onCropRectChange=null;var Q=function(){e[0].style.left=v+h/2-1E5+"px";e[0].style.right=-v-h/2-1E5+"px";e[0].style.top=x+d/2-1E5+"px";e[0].style.bottom=-x-d/2-1E5+"px";e[0].style.width=h+"px";e[0].style.height=
d+"px";B(a.onCropRectChange)};w.on("touchmove mousemove",function(b){b.preventDefault();var c=b.originalEvent.targetTouches;if(!c){if("mouse"!=y)return;c=[{pageX:b.originalEvent.clientX,pageY:b.originalEvent.clientY}]}else if("touch"!=y)return;if(1==c.length&&"crop"==F&&q==c[0].identifier){var e=f;b=p;f=c[0].pageX;p=c[0].pageY;c=f-e;b=p-b;-1==r?(h-c<a.cropRectMinW&&(c=h-a.cropRectMinW),v+c<l&&(c=l-v),h-=c,v+=c):1==r&&(h+c<a.cropRectMinW&&(c=-h+a.cropRectMinW),v+h+c>m&&(c=m-h-v),h+=c);-1==t?(d-b<a.cropRectMinH&&
(b=d-a.cropRectMinH),x+b<g&&(b=g-x),d-=b,x+=b):1==t&&(d+b<a.cropRectMinH&&(b=-d+a.cropRectMinH),x+d+b>n&&(b=n-d-x),d+=b);0==r&&0==t&&(v+c<l?c=l-v:v+h+c>m&&(c=m-h-v),x+b<g?b=g-x:x+d+b>n&&(b=n-d-x),v+=c,x+=b);Q()}});var O=a.setCropRectArea=function(a,c,e,f){if(!b.isCropRectShowing)return!1;-.5<=a||(a=-.5);-.5<=c||(c=-.5);.5>=e||(e=.5);.5>=f||(f=.5);a>e&&(a=e=(a+e)/2);c>f&&(c=f=(c+f)/2);J();v=C+(a+.5)*H;v<l&&(v=l);x=E+(c+.5)*G;x<g&&(x=g);a=C+(e+.5)*H;a>m&&(a=m);h=a-v;f=E+(f+.5)*G;f>n&&(f=n);d=f-x;Q();
return!0},W=a.getCropRectArea=function(a){if(!b.isCropRectShowing)return null;H!=parseFloat(c.style.width)&&J();var g=(v-C)/H-.5,e=(x-E)/G-.5,l=g+h/H,n=e+d/G;a&&(g=Math.round(g*c.fullQualityWidth),e=Math.round(e*c.fullQualityHeight),l=Math.round(l*c.fullQualityWidth),n=Math.round(n*c.fullQualityHeight));return[g,e,l,n]};b.getNeededRect=function(){J();var a={};a.width=2*Math.max(-v,v+h);a.height=2*Math.max(-x,x+d);return a};a.cropAsync=function(a,b){if(D)if(J(),b=b||W()){var d=b[0],g=b[1],e=b[2],l=
b[3];.5>(d+.5)*c.fullQualityWidth&&.5>=(.5-e)*c.fullQualityWidth&&.5>(g+.5)*c.fullQualityHeight&&.5>=(.5-l)*c.fullQualityHeight?B(a,[d,g,e,l]):(T.pushStack({crop:{left:d+.5,top:g+.5,width:e-d,height:l-g}}),T.updateCvsAsync(T.needAlwaysTrueTransform,!1,function(){B(a,[d,g,e,l])}))}else B(a,[null]);else B(a,[null])}},E=new function(){var b=this;(function(){var e=Math.PI/180,f=Math.PI/6,z=Math.PI/18,u=function(a){var b=c.width,d=c.height,e;b>d?b>a&&(e=a/b,b=a,d=Math.round(d*e)||1):d>a&&(e=a/d,d=a,b=
Math.round(b*e)||1);a=$(c).getTransform();var n;0!=a.a*a.d&&0==a.b*a.c?(e=b,n=d):(e=d,n=b);var f=document.createElement("canvas");f.width=e;f.height=n;f=f.getContext("2d");f.setTransform(a.a,a.b,a.c,a.d,e/2*(1-a.a-a.c),n/2*(1-a.b-a.d));f.drawImage(c,0,0,b,d);return f.getImageData(0,0,e,n)},t=function(b,c,g){if("string"==typeof b||b instanceof String||b instanceof Blob)r.getBlobAndFormatFromAnyImgData(b,function(a){a?C(a,null,function(a){t(a,c,g)}):g(null)});else if(b instanceof Image)try{a._noUseButTestSrc=
b.src}catch(O){setTimeout(function(a){throw a;},0);g(null);return}else if(b instanceof ImageData){if(b.width<=c&&b.height<=c){setTimeout(function(){g(b)},0);return}var d=b;b=document.createElement("canvas");b.width=d.width;b.height=d.height;b.getContext("2d").putImageData(d,b.width,b.height)}var e=document.createElement("canvas"),d=b.naturalWidth||b.videoWidth||b.width,l=b.naturalHeight||b.videoHeight||b.height,f=1;d>l?d>c&&(f=c/d,d=c,l=Math.round(l*f)||1):l>c&&(f=c/l,l=c,d=Math.round(d*f)||1);e.width=
d;e.height=l;var k=e.getContext("2d");k.drawImage(b,0,0,e.width,e.height);setTimeout(function(){g(k.getImageData(0,0,e.width,e.height))},0)};a.documentDetectAsync=function(a,b){if(!b){if("perspect"!=F){B(a,[null]);return}V()}var d=KPainter._cv;t(b||u(256),256,function(c){var g=new d.matFromArray(c,d.CV_8UC4);c=g.cols;var l=g.rows,m=Math.min(g.cols,g.rows);d.cvtColor(g,g,d.ColorConversionCodes.COLOR_RGBA2GRAY.value,0);var k=new d.Mat;d.GaussianBlur(g,k,[5,5],0,0,d.BORDER_DEFAULT);d.delMat(g);g=new d.Mat;
d.Canny(k,g,8,.5*m,3,!1);d.delMat(k);var h=new d.Mat;d.HoughLinesP(g,h,1,e,8,8,3);d.delMat(g);for(var r=h.data32s(),q=[],g=c/2,v=l/2,k=0;k<r.length;k+=2)q.push(r[k]-g),q.push(r[k+1]-v);d.delMat(h);for(var u=[],k=0;k<q.length;k+=4){var h=q[k+0],t=q[k+1],x=q[k+2],A=q[k+3],y=t-A,C=x-h,r=h*A-x*t;if(0!=r){var w=0>r?-1:1,D=Math.sqrt(y*y+C*C),y=y/D*w,C=C/D*w,r=r/D*w,w=Math.atan(y/C),D=Math.abs(w);D>f&&D<Math.PI/2-f||(0>C?0==y?(C=-1,w=0):w=-w:0<C?0>y?w=-Math.PI-w:0<y?w=Math.PI-w:(C=1,w=Math.PI):0<y?(y=1,
w=Math.PI/2):(y=-1,w=-Math.PI/2),h=Math.sqrt((x-h)*(x-h)+(A-t)*(A-t)),u.push([y,C,r,w,h]))}}k=[];q=[];E(u,k,2,z,.7*m);E(k,q,2,z,.7*m);m=[null,null,null,null];for(k=0;k<q.length;++k)u=q[k],w=u[3],t=w<3*-Math.PI/4?0:w<-Math.PI/4?1:w<Math.PI/4?2:w<3*Math.PI/4?3:0,m[t]?(h=m[t],w=h[2],y=h[4],r=u[2],h=u[4],r*h>w*y&&(m[t]=u)):m[t]=u;for(k=0;k<m.length;++k)u=m[k],null==u&&(u=[],m[k]=u,0==k?(u[2]=v,u[3]=Math.PI):1==k?(u[2]=g,u[3]=-Math.PI/2):2==k?(u[2]=v,u[3]=0):3==k&&(u[2]=g,u[3]=Math.PI/2)),u[0]=Math.sin(u[3]),
u[1]=-Math.cos(u[3]);g=[];for(k=0;k<m.length;++k)q=m[k],h=m[(k-1+m.length)%m.length],v=q[0],r=q[1],q=q[2],u=h[0],t=h[1],w=h[2],h=(r*w-t*q)/(t*v-r*u),t=(v*w-u*q)/(u*r-v*t),g.push([h/c,t/l]);b||(U(g),p());B(a,[g])})};var E=function(a,b,c,e,f){for(var d=0;d<a.length;++d){for(var g=a[d],l=!1,n=0;n<b.length;++n){var m=b[n],k=m[3],h=g[3],p=k-h;p>Math.PI?h+=2*Math.PI:p<-Math.PI&&(h-=2*Math.PI);p=Math.abs(m[2]-g[2]);if(Math.abs(k-h)<e&&p<c){var l=!0,p=m[4],q=g[4],n=p+q;m[2]=(m[2]*p+g[2]*q)/n;k=(k*p+h*q)/
n;k>Math.PI?k-=2*Math.PI:k<=-Math.PI&&(k+=2*Math.PI);m[3]=k;m[4]=Math.min(n,f);break}}l||b.push([null,null,g[2],g[3],g[4]])}},L=w.children(".kPainterPerspect");b.hideFreeTransformBorderDirectly=function(){L.hide()};var K=w.find("> .kPainterPerspect > .kPainterPerspectCvs")[0],U=a.setFreeTransformCornerPos=function(a){if("perspect"==F){var b=c.kPainterZoom,d=$(c).getTransform(),e=c.width*b,b=c.height*b;if(0==d.a*d.d||0!=d.b*d.c)d=e,e=b,b=d;for(var f=w.borderBoxRect(),d=f.width/2-5,f=f.height/2-5,k=
0;k<H.length;++k){var h=H[k],p=$(h).attr("data-index"),q=a[p],p=e*q[0],q=b*q[1];p<-d?p=-d:p>d&&(p=d);q<-f?q=-f:q>f&&(q=f);h.style.left=p+"px";h.style.right=-p+"px";h.style.top=q+"px";h.style.bottom=-q+"px"}M();L.show()}},P=a.getFreeTransformCornerPos=function(){var a=c.kPainterZoom,b=$(c).getTransform(),e=c.width*a,a=c.height*a;if(0==b.a*b.d||0!=b.b*b.c)b=e,e=a,a=b;for(var b=[],f=0;f<H.length;++f){var k=H[f];b.push([parseFloat(k.style.left)/e,parseFloat(k.style.top)/a])}return b},M=function(){var a=
w.borderBoxRect();K.width=Math.round(a.width);K.height=Math.round(a.height);for(var b=[],c=0;c<H.length;++c)b.push([Math.round(parseFloat(H[c].style.left)+a.width/2),Math.round(parseFloat(H[c].style.top)+a.height/2)]);for(var a=K.getContext("2d"),e=Number.POSITIVE_INFINITY,f,c=0;4>c;++c){var k=b[c][0]*b[c][0]+b[c][1]*b[c][1];k<e&&(e=k,f=c)}for(var h=[],c=0;4>c;++c)h.push([b[(f+c)%4][0],b[(f+c)%4][1]]);a.fillStyle="rgba(0,0,0,0.3)";a.beginPath();a.moveTo(0,0);a.lineTo(h[0][0],h[0][1]);f=function(a,
b,c,d,e,g,f,h){return[Math.sign((d-b)*e+(a-c)*g+c*b-a*d),Math.sign((d-b)*f+(a-c)*h+c*b-a*d)]};b=[];for(c=0;4>c;++c)b.push(f(h[c][0],h[c][1],h[(c+1)%4][0],h[(c+1)%4][1],h[(c+2)%4][0],h[(c+2)%4][1],h[(c+3)%4][0],h[(c+3)%4][1]));c=function(a,b,c,d,e,g,f,h){var k=d-b,l=a-c;a=c*b-a*d;b=h-g;c=e-f;e=f*g-e*h;g=l*b-c*k;return[(a*c-e*l)/g,(e*k-a*b)/g]};f=void 0;e=function(){var a,b,c=h[1][0]-h[0][0];c&&(a=(h[1][1]-h[0][1])/c);var d=h[3][0]-h[0][0];d&&(b=(h[3][1]-h[0][1])/d);return 0<c?0<d?a<=b:!0:0<=d?!1:a<=
b}();0>b[0][0]*b[0][1]?0>b[2][0]*b[2][1]&&(f=c(h[0][0],h[0][1],h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1]),e?(a.lineTo(f[0],f[1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(h[1][0],h[1][1]),a.lineTo(f[0],f[1]),a.lineTo(h[3][0],h[3][1])):(a.lineTo(h[3][0],h[3][1]),a.lineTo(f[0],f[1]),a.lineTo(h[1][0],h[1][1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(f[0],f[1]))):0>b[1][0]*b[1][1]&&0>b[3][0]*b[3][1]&&(f=c(h[1][0],h[1][1],h[2][0],h[2][1],h[3][0],h[3][1],h[0][0],h[0][1]),e?(a.lineTo(h[1][0],h[1][1]),a.lineTo(f[0],
f[1]),a.lineTo(h[3][0],h[3][1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(f[0],f[1])):(a.lineTo(f[0],f[1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(h[3][0],h[3][1]),a.lineTo(f[0],f[1]),a.lineTo(h[1][0],h[1][1])));f||(e?(a.lineTo(h[1][0],h[1][1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(h[3][0],h[3][1])):(a.lineTo(h[3][0],h[3][1]),a.lineTo(h[2][0],h[2][1]),a.lineTo(h[1][0],h[1][1])));a.lineTo(h[0][0],h[0][1]);a.lineTo(0,0);a.lineTo(0,K.height);a.lineTo(K.width,K.height);a.lineTo(K.width,0);a.lineTo(0,0);a.fill()},H=
w.find("> .kPainterPerspect > .kPainterPerspectCorner");H.css("left","0");H.css("top","0");H.css("right","0");H.css("bottom","0");var G=null,v,x,h;H.on("touchstart touchcancel touchend mousedown",function(a){h=this;a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if(!y)y="mouse";else if("mouse"!=y)return;b=[{pageX:a.originalEvent.clientX,pageY:a.originalEvent.clientY}]}else if(b.length)if(!y)y="touch";else if("touch"!=y)return;if(1==b.length)"perspect"==F&&(F="perspectCornerMoving"),
G=b[0].identifier,v=b[0].pageX,x=b[0].pageY;else if(0==b.length&&"perspectCornerMoving"==F){a=L.width()/2-5;var b=L.height()/2-5,c=parseFloat(h.style.left),d=parseFloat(h.style.top),e=!0,f=!0;c<-a?c=-a:c>a?c=a:e=!1;d<-b?d=-b:d>b?d=b:f=!1;e&&(h.style.left=c+"px",h.style.right=-c+"px");f&&(h.style.top=d+"px",h.style.bottom=-d+"px");(e||f)&&M();y=null;F="perspect"}});w.on("touchmove mousemove",function(a){a.preventDefault();var b=a.originalEvent.targetTouches;if(!b){if("mouse"!=y)return;b=[{pageX:a.originalEvent.clientX,
pageY:a.originalEvent.clientY}]}else if("touch"!=y)return;if(1==b.length&&"perspectCornerMoving"==F&&G==b[0].identifier){var c=v;a=x;v=b[0].pageX;x=b[0].pageY;b=v-c;a=x-a;b=parseFloat(h.style.left)+b;a=parseFloat(h.style.top)+a;h.style.left=b+"px";h.style.right=-b+"px";h.style.top=a+"px";h.style.bottom=-a+"px";M()}});w.on("mouseup",function(){"mouse"==y&&"perspectCornerMoving"==F&&(y=null,F="perspect")});w.on("mouseleave",function(a){"mouse"==y&&a.originalEvent.buttons&&"perspectCornerMoving"==F&&
(y=null,F="perspect")});a.freeTransformMaxWH=2048;a.freeTransformAsync=function(b,e,f){if(f||"perspect"==F){V();var d=KPainter._cv,g=e=e||P();.005>Math.abs(g[0][0]-.5)&&.005>Math.abs(g[0][1]-.5)&&.005>Math.abs(g[1][0]+.5)&&.005>Math.abs(g[1][1]-.5)&&.005>Math.abs(g[2][0]+.5)&&.005>Math.abs(g[2][1]+.5)&&.005>Math.abs(g[3][0]-.5)&&.005>Math.abs(g[3][1]+.5)?(p(),"function"==typeof b&&b()):t(f||u(a.freeTransformMaxWH),a.freeTransformMaxWH,function(a){a=new d.matFromArray(a,d.CV_8UC4);d.cvtColor(a,a,d.ColorConversionCodes.COLOR_RGBA2RGB.value,
0);for(var g=new d.Mat.zeros(4,1,d.CV_32FC2),h=g.data32f(),k=0;k<e.length;++k){var l=e[k];h[2*k]=Math.round((l[0]+.5)*a.cols);h[2*k+1]=Math.round((l[1]+.5)*a.rows)}var m=h[2]-h[0],n=h[3]-h[1],l=h[4]-h[2],k=h[5]-h[3],r=h[6]-h[4],u=h[7]-h[5],t=h[0]-h[6],v=h[1]-h[7],h=Math.round(Math.max(Math.sqrt(m*m+n*n),Math.sqrt(r*r+u*u))),l=Math.round(Math.max(Math.sqrt(l*l+k*k),Math.sqrt(t*t+v*v))),t=new d.Mat.zeros(4,1,d.CV_32FC2),k=t.data32f();k[2]=h;k[4]=h;k[5]=l;k[7]=l;k=d.getPerspectiveTransform(g,t);d.delMat(g);
d.delMat(t);g=new d.Mat.zeros(l,h,d.CV_8UC3);t=new d.Scalar(0,255,0);d.warpPerspective(a,g,k,[g.rows,g.cols],d.InterpolationFlags.INTER_LINEAR.value,d.BORDER_CONSTANT,t);d.delMat(a);d.delMat(k);d.delMat(t);a=new ImageData(h,l);t=g.channels();m=g.data();for(n=k=0;k<m.length;k+=t,n+=4)a.data[n]=m[k],a.data[n+1]=m[k+1%t],a.data[n+2]=m[k+2%t],a.data[n+3]=255;d.delMat(g);c.width=h;c.height=l;c.getContext("2d").putImageData(a,0,0);R.setImgStyleFit();q(c,function(a){f?B(b,[a]):(T.pushStack({srcBlob:a,saveFormat:"image/jpeg"}),
T.updateCvsAsync(!0,!1,function(){U([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);F="perspect";p();B(b,[!0])}))},"image/jpeg")})}else B(b,[!1])};a.enterFreeTransformModeAsync=function(a){D&&KPainter.cvHasLoaded?(y=null,F="perspect",V(),setTimeout(function(){A.hideCropRect();T.updateCvsAsync(!0,!1,function(){U([[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]]);L.show();p();T.needAlwaysTrueTransform=!0;B(a,[!0])})},0)):B(a,[!1])};a.exitFreeTransformModeAsync=function(b){"perspect"!=F?B(b,[!1]):(L.hide(),T.updateCvsAsync(!1,
!1,function(){a.isAutoShowCropUI&&A.showCropRect();F=y=null;T.needAlwaysTrueTransform=!1;B(b,[!0])}))}})()};new function(){var b=w.children(".kPainterVideoMdl"),c=b.children(".kPainterVideo")[0],e=b.children(".kPainterBtnGrabVideo"),f=b.children(".kPainterBtnCloseVideo");a.videoSettings={video:{facingMode:{ideal:"environment"}}};a.showVideo=function(e,f){navigator.mediaDevices.getUserMedia(f||a.videoSettings).then(function(a){c.onloadedmetadata=function(){c.onloadedmetadata=c.onerror=null;c.play();
b.show();B(e,[!0])};c.onerror=function(){c.onloadedmetadata=c.onerror=null;B(e,[!1])};c.srcObject=a})["catch"](function(a){B(e,[!1]);setTimeout(function(){throw a;},0)})};a.grabVideo=function(b,e){var f=document.createElement("canvas");f.width=c.videoWidth;f.height=c.videoHeight;f.getContext("2d").drawImage(c,0,0);if(!b)return f;a.addImageAsync(f,e)};a.hideVideo=function(){c.pause();for(var a=c.srcObject.getTracks(),e=0;e<a.length;++e)a[e].stop();b.hide()};a.onAddImgFromGrabVideoBtn=null;e.on("click touchstart",
function(){a.grabVideo(!0,a.onAddImgFromGrabVideoBtn);a.hideVideo()});f.on("click touchstart",function(){a.hideVideo()})}};KPainter.cvFolder=void 0==KPainter.cvFolder?"js":KPainter.cvFolder;KPainter.cvHasLoaded=!1;KPainter._doCallbackNoBreak=function(b,a){if(b)try{b.apply(window,a||[])}catch(q){setTimeout(function(){throw q;},0)}};
KPainter.loadCvScriptAsync=function(b){KPainter._loadCvQueue=KPainter._loadCvQueue||new TaskQueue;KPainter._loadCvQueue.push(function(){KPainter.cvHasLoaded?KPainter._doCallbackNoBreak(b,[!0]):(KPainter._CVModule={cvFolder:KPainter.cvFolder,preRun:[],postRun:[],isRuntimeInitialized:!1,onRuntimeInitialized:function(){KPainter.cvHasLoaded=!0;console.log("Runtime is ready!");KPainter._doCallbackNoBreak(b,[!0]);b=null},onExit:function(){KPainter._doCallbackNoBreak(b,[!1]);b=null},onAbort:function(){KPainter._doCallbackNoBreak(b,
[!1]);b=null},print:function(a){console.log(a)},printErr:function(a){console.log(a)},setStatus:function(a){console.log(a)},totalDependencies:0},KPainter._CVModule.setStatus("Downloading..."),window.WebAssembly?$.ajax({type:"GET",url:KPainter.cvFolder+"/cv-wasm.js?v=20180921",dataType:"script",cache:!0,onerror:function(){KPainter._doCallbackNoBreak(b,[!1])}}):$.ajax({type:"GET",url:KPainter.cvFolder+"/cv.js?v=201800921",dataType:"script",cache:!0,onerror:function(){KPainter._doCallbackNoBreak(b,[!1])}}))})};var MBC = KPainter;
